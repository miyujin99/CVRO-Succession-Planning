<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CVRO Succession Planning - Workshop Playbook</title>
  <!-- PNG fallback -->
<link rel="icon" type="image/png" href="./assets/Favicon-32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="./assets/Favicon-16.png" sizes="16x16" />

<!-- SVG (∆∞u ti√™n) -->
<link rel="icon" type="image/svg+xml" href="./assets/Favicon.svg?v=4" />

<!-- Safari pinned tab (t√πy ch·ªçn) -->
<link rel="mask-icon" href="./assets/Favicon.svg" color="#F68C2C">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { 'ashley-orange': '#F68C2C', 'ashley-orange-dark': '#E67A1A' } } }}
  </script>
  <style>
    body{box-sizing:border-box}
    .fade-in{animation:fadeIn .25s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body class="bg-gray-50 font-sans">
  <!-- H·ªôp c√¢u h·ªèi b·∫£o m·∫≠t -->

  <!-- Header -->
  <header class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-8">
          <div class="flex-shrink-0">
          <img src="assets/ahr-logo.png" alt="Asia Human Resources Logo" class="h-12">
        </div>
          <nav class="hidden md:flex space-x-6">
            <button data-tab="home" onclick="showTab('home', event)" class="nav-tab text-gray-700 hover:text-ashley-orange px-3 py-2 text-sm font-medium border-b-2 border-ashley-orange">Home</button>
            <button data-tab="framework" onclick="showTab('framework', event)" class="nav-tab text-gray-700 hover:text-ashley-orange px-3 py-2 text-sm font-medium">Framework (6 Stages)</button>
            <button data-tab="tools" onclick="showTab('tools', event)" class="nav-tab text-gray-700 hover:text-ashley-orange px-3 py-2 text-sm font-medium">Tools & Templates</button>
            <button data-tab="metrics" onclick="showTab('metrics', event)" class="nav-tab text-gray-700 hover:text-ashley-orange px-3 py-2 text-sm font-medium">Metrics & Governance</button>
            <button data-tab="faq" onclick="showTab('faq', event)" class="nav-tab text-gray-700 hover:text-ashley-orange px-3 py-2 text-sm font-medium">FAQ</button>
          </nav>
          <button onclick="openSearchModal()"class="hidden md:inline-flex bg-white border px-3 py-2 rounded-xl text-sm hover:bg-gray-100">üîé Search</button>
        </div>
      </div>
    </div>
  </header>

  <!-- CTA Row -->
  <div class="bg-ashley-orange text-white py-3 sticky top-16 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-wrap justify-center md:justify-end items-center gap-3">
      <button class="bg-white text-ashley-orange px-4 py-2 rounded-xl text-sm font-medium hover:bg-gray-100">üì• Download All Templates</button>
      <button onclick="showQuestionModal()" class="bg-white text-ashley-orange px-4 py-2 rounded-xl text-sm font-medium hover:bg-gray-100">‚ùì I Have A Question!</button>
      </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- HOME TAB -->
    <section id="home-tab" class="tab-content">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">CVRO Succession Planning ‚Äì Workshop Playbook</h1>
        <p class="text-xl text-gray-600 mb-2">Build leadership continuity, readiness, and visibility.</p>
        <p class="text-lg text-gray-500 mb-8">X√¢y d·ª±ng t√≠nh li√™n t·ª•c l√£nh ƒë·∫°o, m·ª©c ƒë·ªô s·∫µn s√†ng v√† t√≠nh minh b·∫°ch.</p>
      </div>
      <div class="grid md:grid-cols-3 gap-6 mb-12">
        <div class="bg-white rounded-xl shadow-sm border p-6 hover:shadow-md transition-shadow">
          <div class="w-12 h-12 bg-ashley-orange rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üìä</span></div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Executive Overview</h3>
          <p class="text-sm text-gray-500 mb-2">T·ªïng quan ch∆∞∆°ng tr√¨nh</p>
          <p class="text-gray-600">Transparent ¬∑ Fair ¬∑ Development‚Äëfocused; readiness over title; evidence via SBI.</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border p-6 hover:shadow-md transition-shadow">
          <div class="w-12 h-12 bg-ashley-orange rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üõ†Ô∏è</span></div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Hands‚Äëon Tools</h3>
          <p class="text-sm text-gray-500 mb-2">B·ªô c√¥ng c·ª• th·ª±c h√†nh</p>
          <p class="text-gray-600">Templates, checklists, and sheets headers for end‚Äëto‚Äëend execution.</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border p-6 hover:shadow-md transition-shadow">
          <div class="w-12 h-12 bg-ashley-orange rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üéØ</span></div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Step‚Äëby‚Äëstep Workshops</h3>
          <p class="text-sm text-gray-500 mb-2">K·ªãch b·∫£n workshop theo b∆∞·ªõc</p>
        </div>
      </div>
      <div class="text-center flex flex-wrap gap-3 justify-center">
        <button onclick="showTab('framework', event)" class="bg-white text-ashley-orange border-2 border-ashley-orange px-6 py-3 rounded-xl font-medium hover:bg-ashley-orange hover:text-white">üìãFramework Navigator</button>
        <button onclick="showTab('tools', event)" class="bg-white text-ashley-orange border-2 border-ashley-orange px-6 py-3 rounded-xl font-medium hover:bg-ashley-orange hover:text-white">üìÅ Tools & Templates</button>
      </div>
    </section>

   
    <!-- FRAMEWORK TAB -->
    <section id="framework-tab" class="tab-content hidden">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">6‚ÄëStage Framework</h2>
        <p class="text-gray-600 mb-6">6 Key Stages Succession Planning Process</p>

        <!-- Stepper -->
        <div class="bg-white rounded-xl border p-6 mb-6">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-4">
              <div class="step-indicator w-8 h-8 bg-ashley-orange text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
              <div class="step-line w-16 h-1 bg-ashley-orange"></div>
              <div class="step-indicator w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-bold">2</div>
              <div class="step-line w-16 h-1 bg-gray-300"></div>
              <div class="step-indicator w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-bold">3</div>
              <div class="step-line w-16 h-1 bg-gray-300"></div>
              <div class="step-indicator w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-bold">4</div>
              <div class="step-line w-16 h-1 bg-gray-300"></div>
              <div class="step-indicator w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-bold">5</div>
              <div class="step-line w-16 h-1 bg-gray-300"></div>
              <div class="step-indicator w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-bold">6</div>
            </div>
            <div id="stepLabel" class="text-sm text-gray-500">Stage 1 of 6</div>
          </div>
          <div class="flex flex-wrap gap-2 mb-4">
            <button onclick="showStep(1, event)" class="step-btn bg-ashley-orange text-white px-3 py-1 rounded text-sm">Stage 1</button>
            <button onclick="showStep(2, event)" class="step-btn bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Stage 2</button>
            <button onclick="showStep(3, event)" class="step-btn bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Stage 3</button>
            <button onclick="showStep(4, event)" class="step-btn bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Stage 4</button>
            <button onclick="showStep(5, event)" class="step-btn bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Stage 5</button>
            <button onclick="showStep(6, event)" class="step-btn bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Stage 6</button>
          </div>
        </div>

        <!-- STAGE 1 CONTENT -->
        <div id="step-1" class="step-content">
          <div class="bg-white rounded-xl border p-6 mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">STAGE 1: Identify Critical Positions & Define Success Profile</h3>
            <p class="text-gray-600 mb-6">To ensure organizational continuity <strong>by identifying the most business-critical positions for succession planning</strong> and clearly <strong>defining the expectations</strong> for successors.</p>
            <div class="border-b mb-6">
              <nav class="flex flex-wrap gap-5">
                <button onclick="showStepTab('overview', event)" class="step-tab-btn border-b-2 border-ashley-orange text-ashley-orange py-2 px-1 text-sm font-medium">Overview</button>
                <button onclick="showStepTab('criteria', event)" class="step-tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium">Part A: Identify Critical Positions</button>
                <button onclick="showStepTab('profile', event)" class="step-tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium">Part B: Define Success Profile for Selected Positions</button>
              </nav>
            </div>

<!-- Overview Tab -->
<div id="s1-overview-tab" class="step-tab-content">
  <div class="space-y-6">

    <!-- Header -->
    <div class="bg-white italic">
      <p class="text-sm text-gray-700"> Overview of Stage 1 to ensure continuity by identifying business-critical roles and defining clear success expectations.
      </p>
    </div>

    <!-- Part A -->
    <details class="group bg-orange-50 border-l-4 border-ashley-orange rounded-r-lg">
      <summary class="flex items-center justify-between cursor-pointer select-none px-5 py-3">
        <span class="font-semibold text-ashley-orange text-base flex items-center gap-2">
          üß≠ Part A ‚Äì Identify Critical Positions
        </span>
        <!-- Chevron -->
        <svg class="h-5 w-5 text-ashley-orange transition-transform duration-200 ease-out">
          <path fill="currentColor" d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.12l3.71-2.89a.75.75 0 1 1 1.04 1.08l-4.24 3.31a.75.75 0 0 1-.93 0L5.21 8.31a.75.75 0 0 1 .02-1.1z"/>
        </svg>
      </summary>
      <div class="px-5 pb-4 pt-1 text-sm text-gray-800">
        <p class="mb-2">
          HoDs assess roles in their teams to decide which are <span class="font-medium">business-critical</span>.
          Two criteria sets are available:
        </p>
        <ul class="list-disc pl-5 space-y-1">
          <li><span class="font-medium">Option 1 ‚Äì Standard Market (Weighted):</span> Urgency, Business Impact, Required Skills/Expertise, Internal Talent Availability, External Hiring Difficulty.</li>
          <li><span class="font-medium">Option 2 ‚Äì CVRO Customized (Equal 20%):</span> Succession Urgency & Internal Readiness, Cost Efficiency, Leadership & Culture Impact, Strategic Contribution, Skill Scarcity & Market Competition.</li>
        </ul>
        <p class="mt-3 text-xs text-gray-700">Scoring note: Score per criterion 1‚Äì5; total score is the average of 5 criteria (20% each).</p>
      </div>
    </details>

    <!-- Part B -->
    <details class="group bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
      <summary class="flex items-center justify-between cursor-pointer select-none px-5 py-3">
        <span class="font-semibold text-blue-700 text-base flex items-center gap-2">
          üéØ Part B ‚Äì Define Success Profile
        </span>
        <!-- Chevron -->
        <svg class="h-5 w-5 text-blue-600 transition-transform duration-200 ease-out">
          <path fill="currentColor" d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.12l3.71-2.89a.75.75 0 1 1 1.04 1.08l-4.24 3.31a.75.75 0 0 1-.93 0L5.21 8.31a.75.75 0 0 1 .02-1.1z"/>
        </svg>
      </summary>
      <div class="px-5 pb-4 pt-1 text-sm text-gray-800">
        <p class="mb-2">
          Departments finalize the <span class="font-medium">Success Profile</span> for each selected role:
        </p>
        <ul class="list-disc pl-5 space-y-1">
          <li><span class="font-medium">Competency requirements:</span> leadership & technical skills (criteria in the Performance Evaluation System).</li>
          <li><span class="font-medium">Job qualifications:</span> education, experience, certifications, tools (from departmental JDs; consolidate into the template).</li>
        </ul>
        <p class="mt-3">
          The finalized profile serves as the benchmark for <span class="font-medium">Stage 3 ‚Äì Gap Assessment</span>.
        </p>
      </div>
    </details>

<!-- STAGE 1 summary line -->
<div class="bg-white-50 border-l-4 border-red-400 rounded-r-lg p-4 text-sm text-gray-800">
  <span class="font-bold text-ashley-orange">Part A clarifies</span>
  <span class="font-bold">which positions should be prioritized for succession</span>;
  <span class="font-bold text-blue-700">Part B defines</span>
  <span class="font-bold">what successors are expected to grow toward</span>.
</div>
</div>
<!-- Scoped styles for chevron rotation (no impact to other tabs) -->
<style>
  #s1-overview-tab details[open] > summary svg { transform: rotate(180deg); }
</style>
</div>
<!-- Part A: Identify Critical Positions -->
<div id="s1-criteria-tab" class="step-tab-content hidden">
  <div class="space-y-6">
    <div>
      <p class="font-semibold text-gray-700 text-base mb-4">
        CVRO Department Heads (HOD) are responsible for evaluating positions within their teams.
        Two options are presented for evaluation criteria:
      </p>
    </div>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="bg-white border-2 border-gray-200 rounded-lg p-4">
        <h4 class="font-semibold text-gray-900 mb-3">Option 1 ‚Äì Standard Market Criteria (Weighted)</h4>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between"><span>Urgency</span><span class="font-medium">20%</span></div>
          <div class="flex justify-between"><span>Impact</span><span class="font-medium">30%</span></div>
          <div class="flex justify-between"><span>Skills</span><span class="font-medium">30%</span></div>
          <div class="flex justify-between"><span>Internal Talent</span><span class="font-medium">15%</span></div>
          <div class="flex justify-between"><span>External Difficulty</span><span class="font-medium">5%</span></div>
        </div>
      </div>

      <div class="bg-white border-2 border-ashley-orange rounded-lg p-4">
        <h4 class="font-semibold text-ashley-orange mb-3">Option 2 ‚Äì CVRO Customized (Equal 20% each)</h4>
        <div class="space-y-2 text-sm text-gray-700">
          <div class="flex justify-between"><span>Succession Urgency & Internal Readiness</span><span class="font-medium">20%</span></div>
          <div class="flex justify-between"><span>Cost Efficiency</span><span class="font-medium">20%</span></div>
          <div class="flex justify-between"><span>Leadership & Culture Impact</span><span class="font-medium">20%</span></div>
          <div class="flex justify-between"><span>Strategic Contribution</span><span class="font-medium">20%</span></div>
          <div class="flex justify-between"><span>Skill Scarcity & Market Competition</span><span class="font-medium">20%</span></div>
        </div>
      </div>
    </div>
	    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
      <div class="flex items-center gap-2">
        <span class="bg-ashley-orange text-white px-2 py-1 rounded text-xs font-bold">AHR RECOMMENDS</span>
        <span class="text-yellow-800 font-medium">Option 2 - CVRO Customized</span>
      </div>
    </div>
 <!-- Scoring Tab -->
<!-- Section Title -->
<h2 class="text-xl font-semibold text-[#F68C2C]">üìä Classification Criteria</h2>

<!-- 5 Info Boxes with Popovers -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">

  <!-- Box 1 -->
  <div class="help-wrap relative">
    <button type="button"
            onclick="toggleHelp('pop-succession', event)"
            class="w-full h-full text-left bg-white border rounded-xl p-4 hover:shadow-md transition flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h5 class="font-semibold text-gray-900 text-sm">
          Succession Urgency & Internal Readiness (20%)
        </h5>
        <span class="text-ashley-orange font-bold text-base leading-none">?</span>
      </div>
      <p class="text-xs text-gray-500">Click to view details</p>
    </button>
    <div id="pop-succession"
         class="score-help hidden absolute left-0 top-full mt-2 w-80 bg-white border rounded-lg shadow-lg p-3 z-50">
      <p class="text-xs font-semibold mb-2">How soon will this role likely be vacant, and is there an internal successor ready?</p>
      <ul class="text-xs text-gray-700 space-y-1">
        <li><b>5</b> ‚Äì Vacancy ve		y likely within months (retirement, resignation, promotion, transfer) and no successor ready.</li>
        <li><b>4</b> ‚Äì Vacancy likely within 6‚Äì12 months;  successor exists but needs significant development.</li>
        <li><b>3</b> ‚Äì Vacancy possible in 1‚Äì2y, successor exists but needs moderate upskilling.</li>
        <li><b>2</b> ‚Äì No planned change but medium risk; candidate nearly ready.</li>
        <li><b>1</b> ‚Äì Stable long-term, no anticipated change; candidate fully ready.</li>
      </ul>
    </div>
  </div>

  <!-- Box 2 -->
  <div class="help-wrap relative">
    <button type="button"
            onclick="toggleHelp('pop-cost', event)"
            class="w-full h-full text-left bg-white border rounded-xl p-4 hover:shadow-md transition flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h5 class="font-semibold text-gray-900 text-sm">
          Cost Efficiency (20%)
        </h5>
        <span class="text-ashley-orange font-bold text-base leading-none">?</span>
      </div>
      <p class="text-xs text-gray-500">Click to view details</p>
    </button>
    <div id="pop-cost"
         class="score-help hidden absolute left-0 top-full mt-2 w-80 bg-white border rounded-lg shadow-lg p-3 z-50">
      <p class="text-xs font-semibold mb-2">(How much cost is saved internally vs external? (including ramp-up & hidden costs)?)</p>
      <ul class="text-xs text-gray-700 space-y-1">
        <li><b>5</b> ‚Äì Internal saves huge cost, minimal ramp-up.</li>
        <li><b>4</b> ‚Äì Noticeable saving, moderate training cost.</li>
        <li><b>3</b> ‚Äì Moderate saving, some training cost.</li>
        <li><b>2</b> ‚Äì Slight saving, low training cost.</li>
        <li><b>1</b> ‚Äì No cost advantage; same as external.</li>
      </ul>
    </div>
  </div>

  <!-- Box 3 -->
  <div class="help-wrap relative">
    <button type="button"
            onclick="toggleHelp('pop-leadership', event)"
            class="w-full h-full text-left bg-white border rounded-xl p-4 hover:shadow-md transition flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h5 class="font-semibold text-gray-900 text-sm">
          Leadership & Culture Impact (20%)
        </h5>
        <span class="text-ashley-orange font-bold text-base leading-none">?</span>
      </div>
      <p class="text-xs text-gray-500">Click to view details</p>
    </button>
    <div id="pop-leadership"
         class="score-help hidden absolute left-0 top-full mt-2 w-80 bg-white border rounded-lg shadow-lg p-3 z-50">
      <p class="text-xs font-semibold mb-2">How strongly does this role inspire, influence, and shape company values, leadership culture, and team aspiration?</p>
      <ul class="text-xs text-gray-700 space-y-1">
        <li><b>5</b> ‚Äì Critical leadership role with strong influence on company values, leadership culture, and team aspiration. Inspires and motivates across the organization.</li>
        <li><b>4</b> ‚Äì Strong influence on department‚Äôs leadership culture and maintaining motivation.</li>
        <li><b>3</b> ‚Äì Moderate leadership/culture influence; role models desired behaviors.</li>
        <li><b>2</b> ‚Äì Minor leadership/culture influence; helps maintain team stability.</li>
        <li><b>1</b> ‚Äì Minimal influence.</li>
      </ul>
    </div>
  </div>

  <!-- Box 4 -->
  <div class="help-wrap relative">
    <button type="button"
            onclick="toggleHelp('pop-strategy', event)"
            class="w-full h-full text-left bg-white border rounded-xl p-4 hover:shadow-md transition flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h5 class="font-semibold text-gray-900 text-sm">
          Strategic Contribution (20%)
        </h5>
        <span class="text-ashley-orange font-bold text-base leading-none">?</span>
      </div>
      <p class="text-xs text-gray-500">Click to view details</p>
    </button>
    <div id="pop-strategy"
         class="score-help hidden absolute left-0 top-full mt-2 w-80 bg-white border rounded-lg shadow-lg p-3 z-50">
      <p class="text-xs font-semibold mb-2">If vacant, how would it affect company‚Äôs strategy?</p>
      <ul class="text-xs text-gray-700 space-y-1">
        <li><b>5</b> ‚Äì Cross-department, multi-functional strategic impact.</li>
        <li><b>4</b> ‚Äì Significant impact on one major department.</li>
        <li><b>3</b> ‚Äì Manageable impact, limited to certain areas.</li>
        <li><b>2</b> ‚Äì Minor or indirect impact.</li>
        <li><b>1</b> ‚Äì Minimal or negligible impact.</li>
      </ul>
    </div>
  </div>

  <!-- Box 5 -->
  <div class="help-wrap relative">
    <button type="button"
            onclick="toggleHelp('pop-scarcity', event)"
            class="w-full h-full text-left bg-white border rounded-xl p-4 hover:shadow-md transition flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h5 class="font-semibold text-gray-900 text-sm">
          Skill Scarcity & Market Competition (20%)
        </h5>
        <span class="text-ashley-orange font-bold text-base leading-none">?</span>
      </div>
      <p class="text-xs text-gray-500">Click to view details</p>
    </button>
    <div id="pop-scarcity"
         class="score-help hidden absolute left-0 top-full mt-2 w-80 bg-white border rounded-lg shadow-lg p-3 z-50">
      <p class="text-xs font-semibold mb-2">How rare are the skills required for this role, and how difficult is it to hire externally?)</p>
      <ul class="text-xs text-gray-700 space-y-1">
        <li><b>5</b> ‚Äì Highly specialized skills, extremely hard to hire externally.</li>
        <li><b>4</b> ‚Äì Rare, difficult to hire.</li>
        <li><b>3</b> ‚Äì Moderate availability.</li>
        <li><b>2</b> ‚Äì Common, easy to hire.</li>
        <li><b>1</b> ‚Äì Very common skills.</li>
      </ul>
    </div>
  </div>
</div>

<!-- Script -->
<script>
  function toggleHelp(id, e){
    if (e) e.stopPropagation();
    document.querySelectorAll('.score-help').forEach(el=>{
      if(el.id!==id) el.classList.add('hidden');
    });
    const el=document.getElementById(id);
    if(el) el.classList.toggle('hidden');
  }
  document.addEventListener('click', (ev)=>{
    if(!ev.target.closest('.help-wrap')){
      document.querySelectorAll('.score-help').forEach(el=>el.classList.add('hidden'));
    }
  });
</script>
  <!-- 4 box ph√¢n lo·∫°i -->
  <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
      <h4 class="font-bold text-red-900 mb-1">1. Critical Role</h4>
      <p class="text-red-800 text-sm mb-2">‚â•4.2 points</p>
      <p class="text-red-700 text-xs">Need to have the strategic consideration from top leadership.</p>
    </div>
    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
      <h4 class="font-bold text-orange-900 mb-1">2. High Importance</h4>
      <p class="text-orange-800 text-sm mb-2">3.5‚Äì4.19 points</p>
      <p class="text-orange-700 text-xs">Requires successor planning application.</p>
    </div>
    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
      <h4 class="font-bold text-yellow-900 mb-1">3. Moderate Importance</h4>
      <p class="text-yellow-800 text-sm mb-2">2.8‚Äì3.49 points</p>
      <p class="text-yellow-700 text-xs">Important but not urgent; succession planning optional.</p>
    </div>
    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
      <h4 class="font-bold text-green-900 mb-1">4. Low Importance</h4>
      <p class="text-green-800 text-sm mb-2">&lt;2.8 points</p>
      <p class="text-green-700 text-xs">Less critical at this stage</p>
    </div>
  </div>

  <div class="mt-4 bg-blue-50 p-4 rounded-lg">
    <p class="text-blue-800 text-sm"><strong>Note:</strong> HoDs may flex classifications with documented rationale.</p>
  </div>


<!-- ===================== Department Scoring Calculator (as its own bordered card) ===================== -->
<section id="s1-calculator" class="mt-8 border-2 border-gray-300 rounded-2xl bg-white overflow-hidden">
  <!-- Header c·ªßa card -->
  <div class="px-5 py-4 border-b-2 border-gray-200 flex flex-col sm:flex-row justify-between gap-2 sm:items-center">
    <div class="flex items-center gap-3">
      <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-ashley-orange text-white text-lg">üìä</span>
      <div>
        <h2 class="text-lg font-semibold text-gray-900">Department Scoring Calculator</h2>
        <p class="text-xs text-gray-500">Part A ‚Äì Identify Critical Positions</p>
      </div>
    </div>

    <div class="flex items-center gap-3 flex-wrap">
      <label class="inline-flex items-center gap-2 text-sm text-gray-700">
        <input id="openEmailCheckbox" type="checkbox" class="h-4 w-4 rounded border-gray-300" checked>
        üìß Open email draft after export
      </label>
      <button id="btnExportXLSX"
              class="px-4 py-2 rounded-xl bg-ashley-orange text-white hover:bg-ashley-orange-dark transition">
        ‚¨á Download Excel
      </button>
      <button id="btnEmailAHR"
              class="px-4 py-2 rounded-xl bg-white border text-gray-700 hover:bg-gray-100 transition">
        ‚úâÔ∏è Email AHR
      </button>
    </div>
  </div>

  <!-- Body c·ªßa card -->
  <div class="p-5">
    <!-- Department selector -->
    <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center mb-4">
      <label class="text-sm font-medium text-gray-700">Select Department</label>
      <select id="deptSelect"
              class="border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 min-w-64">
        <option value="" selected disabled>‚Äî Loading departments‚Ä¶ ‚Äî</option>
      </select>
      <div class="flex items-center gap-2">
        <button id="btnAddRow"
                class="px-4 py-2 rounded-xl bg-white border text-gray-700 hover:bg-gray-100 transition">
          ‚ûï Add Role
        </button>
        <button id="btnReset"
                class="px-4 py-2 rounded-xl bg-white border text-gray-700 hover:bg-gray-100 transition">
          ‚ôª Reset
        </button>
      </div>
    </div>

    <!-- Table wrapper -->
    <div class="overflow-x-auto border rounded-2xl">
      <table class="min-w-[1000px] w-full text-sm bg-white">
        <thead class="bg-gray-50">
          <tr class="text-gray-800">
            <th class="px-3 py-3 text-center w-5 bg-orange-50">No.</th>
            <th class="px-3 py-3 text-center w-40 bg-orange-50">Role</th>
            <th class="px-3 py-3 text-center bg-orange-50">Succession Urgency &<br/>Internal Readiness</th>
            <th class="px-3 py-3 text-center bg-orange-50">Cost Efficiency</th>
            <th class="px-3 py-3 text-center bg-orange-50">Leadership & Culture<br/>Impact</th>
            <th class="px-3 py-3 text-center bg-orange-50">Strategic Impact</th>
            <th class="px-3 py-3 text-center bg-orange-50">Skill Scarcity & External<br/>Hiring Difficulty</th>
            <th class="px-3 py-3 text-center w-30 text-[#F68C2C] bg-orange-50">Total</th>
            <th class="px-3 py-3 text-center w-30 text-[#F68C2C] bg-orange-50">Result</th>
            <th class="px-3 py-3 text-center w-30 text-[#F68C2C] bg-orange-50">Include in Succession Planning?</th>
            <th class="px-3 py-3 text-center w-50 text-[#F68C2C] bg-orange-50">HoD Adjustment Rationale</th>
            <th class="px-3 py-3 text-center bg-orange-50">Remove?</th>
          </tr>
        </thead>
        <tbody id="scoreRows"></tbody>
      </table>
    </div>

    <p class="text-xs text-gray-500 mt-3">
      * Score per criterion: 1‚Äì5. Total score = average of the 5 criteria (20% weight each).
    </p>
  </div>
</section>

<!-- ========== JS cho Official Scoring Table (THAY C·∫¢ PH·∫¶N N√ÄY) ========== -->
<!-- SheetJS (xu·∫•t Excel) -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
  /* ========= 1) Data model (auto-load from ./assets) ========= */
  // K·ª≥ v·ªçng 1 trong 2 file t·ªìn t·∫°i trong ./assets/:
  //   a) dept_roles.json
  //      - D·∫°ng 1 (object): { "ahr": { "name":"Asia Human Resources", "roles":[...] }, ... }
  //      - D·∫°ng 2 (array):  [ { "code":"ahr","name":"Asia Human Resources","roles":[...] }, ... ]
  //   b) departments_roles.csv  (fallback n·∫øu kh√¥ng c√≥ JSON)
  //      Header: code,name,role
  //      Nhi·ªÅu d√≤ng role cho c√πng 1 code/name
  //
  // V√≠ d·ª• CSV:
  // code,name,role
  // ahr,Asia Human Resources,Senior Team Leader of Human Resources
  // ahr,Asia Human Resources,Talent Development Project Leader
  // ...

  let DEPT_MAP = {};  // { code: { name: string, roles: string[] } }

  async function loadDeptData() {
    // ∆Øu ti√™n JSON
    try {
      const r = await fetch('./assets/dept_roles.json', { cache: 'no-store' });
      if (r.ok) {
        const data = await r.json();
        if (Array.isArray(data)) {
          // array: [{code,name,roles}]
          data.forEach(d => {
            if (!d?.code) return;
            DEPT_MAP[d.code] = { name: d.name ?? d.code, roles: Array.isArray(d.roles) ? d.roles : [] };
          });
        } else if (data && typeof data === 'object') {
          // object map
          Object.entries(data).forEach(([code, val]) => {
            if (!code) return;
            const name = val?.name ?? code;
            const roles = Array.isArray(val?.roles) ? val.roles : [];
            DEPT_MAP[code] = { name, roles };
          });
        }
      } else {
        throw new Error('dept_roles.json not found');
      }
    } catch (e) {
      // Fallback: CSV
      await loadDeptDataFromCSV('./assets/departments_roles.csv');
    }

    // N·∫øu v·∫´n r·ªóng ‚Üí g·∫Øn t·∫°m ƒë·ªÉ trang kh√¥ng l·ªói
    if (!Object.keys(DEPT_MAP).length) {
      console.warn('No dept data found in ./assets. Please add dept_roles.json or departments_roles.csv');
    }

    hydrateDeptSelect();
  }

  async function loadDeptDataFromCSV(url) {
    try {
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error('CSV not found');
      const text = await r.text();
      parseDeptCSV(text);
    } catch (e) {
      console.warn('CSV load failed:', e);
    }
  }

  function parseDeptCSV(csvText) {
    const lines = csvText.split(/\r?\n/).filter(l => l.trim().length);
    if (!lines.length) return;
    // l·∫•y header
    const header = lines[0].split(',').map(h => h.trim().toLowerCase());
    const idxCode = header.indexOf('code');
    const idxName = header.indexOf('name');
    const idxRole = header.indexOf('role');
    if (idxCode < 0 || idxName < 0 || idxRole < 0) {
      console.warn('CSV header must include code,name,role');
      return;
    }
    for (let i = 1; i < lines.length; i++) {
      const cols = splitCSVLine(lines[i]);
      const code = (cols[idxCode] || '').trim();
      const name = (cols[idxName] || '').trim() || code;
      const role = (cols[idxRole] || '').trim();
      if (!code || !role) continue;
      if (!DEPT_MAP[code]) DEPT_MAP[code] = { name, roles: [] };
      if (!DEPT_MAP[code].roles.includes(role)) DEPT_MAP[code].roles.push(role);
      // n·∫øu name kh√°c tr∆∞·ªõc th√¨ c·∫≠p nh·∫≠t theo d√≤ng CSV m·ªõi nh·∫•t
      DEPT_MAP[code].name = name || DEPT_MAP[code].name;
    }
  }

  // parser CSV ƒë∆°n gi·∫£n (h·ªó tr·ª£ d·∫•u ph·∫©y trong "...")
  function splitCSVLine(line) {
    const out = [];
    let cur = '', inQ = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') {
        if (inQ && line[i+1] === '"') { cur += '"'; i++; }
        else inQ = !inQ;
      } else if (ch === ',' && !inQ) {
        out.push(cur); cur = '';
      } else {
        cur += ch;
      }
    }
    out.push(cur);
    return out;
  }

  function hydrateDeptSelect() {
    const sel = document.getElementById('deptSelect');
    if (!sel) return;
    sel.innerHTML = '<option value="" selected disabled>‚Äî Choose a department ‚Äî</option>';

    const entries = Object.entries(DEPT_MAP).sort((a, b) => a[1].name.localeCompare(b[1].name, 'en'));
    entries.forEach(([code, v]) => {
      const opt = document.createElement('option');
      opt.value = code;
      opt.textContent = v.name || code;
      sel.appendChild(opt);
    });
  }

  /* ========= 2) Ph√¢n lo·∫°i ========= */
  function classify(score){
    if (score >= 4.2)  return {label:'Critical Role',       bg:'bg-red-50',    text:'text-red-800',    border:'border-red-500'};
    if (score >= 3.5)  return {label:'High Importance',     bg:'bg-orange-50', text:'text-orange-800', border:'border-orange-500'};
    if (score >= 2.8)  return {label:'Moderate Importance', bg:'bg-yellow-50', text:'text-yellow-800', border:'border-yellow-500'};
    return               {label:'Low Importance',           bg:'bg-green-50',  text:'text-green-800',  border:'border-green-500'};
  }

  /* ========= 3) Include cell ========= */
  function renderIncludeCell(tr, label){
    const cell = tr.querySelector('.include-cell');
    if (!cell) return;
    cell.innerHTML = '';
    if (!label) return;

    if (label === 'Low Importance'){
      cell.innerHTML = `<span class="text-gray-400 text-base select-none">‚úñ</span>`;
      const rat = tr.querySelector('.rationale-input');
      const warn = tr.querySelector('.rationale-warn');
      if (rat){ rat.disabled = true; rat.value=''; rat.classList.remove('border-red-400','ring-1','ring-red-300'); }
      tr.classList.remove('bg-red-50'); warn?.classList.add('hidden');
      return;
    }
    const checked = (label === 'High Importance') ? 'checked' : '';
    cell.innerHTML = `<input type="checkbox" class="include-checkbox h-4 w-4" ${checked}>`;
    const rat = tr.querySelector('.rationale-input');
    if (rat){ rat.disabled = false; }
    const cb = cell.querySelector('.include-checkbox');
    if (cb){ cb.addEventListener('change', () => requireRationaleIfIncluded(tr)); }
  }

  function requireRationaleIfIncluded(tr){
    const cb   = tr.querySelector('.include-checkbox');
    const rat  = tr.querySelector('.rationale-input');
    const warn = tr.querySelector('.rationale-warn');
    const resultText = tr.querySelector('.result-pill')?.textContent.trim();

    if (!cb){
      tr.classList.remove('bg-red-50');
      warn?.classList.add('hidden');
      if (rat){ rat.disabled = true; rat.value=''; rat.classList.remove('border-red-400','ring-1','ring-red-300'); }
      return;
    }
    if (rat) rat.disabled = false;

    const exempt  = (resultText === 'High Importance');
    const needWarn = cb.checked && !exempt && (!rat?.value || !rat.value.trim());

    if (needWarn){
      tr.classList.add('bg-red-50');
      warn?.classList.remove('hidden');
      rat?.classList.add('border-red-400','ring-1','ring-red-300');
    } else {
      tr.classList.remove('bg-red-50');
      warn?.classList.add('hidden');
      rat?.classList.remove('border-red-400','ring-1','ring-red-300');
    }
  }

  function clampTo1to5(inp){
    const raw = String(inp.value).trim();
    if (raw === '') return null;
    let n = Math.round(parseFloat(raw));
    if (isNaN(n)) { inp.value = ''; return null; }
    if (n < 1) n = 1;
    if (n > 5) n = 5;
    inp.value = n;
    return n;
  }

  function recomputeRow(tr){
    const inputs = Array.from(tr.querySelectorAll('.score-input'));
    const values = inputs.map(inp => clampTo1to5(inp));
    const valid  = values.every(v => v !== null);

    const totalEl = tr.querySelector('.total-cell');
    const pill    = tr.querySelector('.result-pill');

    if (valid){
      const avg = (values.reduce((a,b)=>a+b,0) / 5);
      totalEl.textContent = avg.toFixed(2);
      const c = classify(avg);
      pill.textContent = c.label;
      pill.className   = `result-pill inline-block px-2 py-1 rounded border text-xs ${c.bg} ${c.text} ${c.border}`;
      renderIncludeCell(tr, c.label);
    } else {
      totalEl.textContent = '‚Äî';
      pill.textContent    = '‚Äî';
      pill.className      = 'result-pill inline-block px-2 py-1 rounded border text-xs';
      renderIncludeCell(tr, null);
      tr.classList.remove('bg-red-50');
      tr.querySelector('.rationale-warn')?.classList.add('hidden');
      tr.querySelector('.rationale-input')?.classList.remove('border-red-400','ring-1','ring-red-300');
    }
    requireRationaleIfIncluded(tr);
  }
function autosizeRole(el) {
  el.style.height = 'auto';
  el.style.height = el.scrollHeight + 'px';
}
function autosizeAllRoles(){
  document.querySelectorAll('#scoreRows .role-input, #scoreRows .rationale-input')
    .forEach(ta => autosizeRole(ta));
}

function attachDelegatedHandlers(){
  const tbody = document.getElementById('scoreRows');
  if (!tbody) return;

tbody.addEventListener('input', e => {
  const t = e.target;
  if (t.classList.contains('role-input')) {
    autosizeRole(t);
    saveDebounced();
  }
  if (t.classList.contains('score-input')){
    clampTo1to5(t);
    const tr = t.closest('tr'); if (tr) recomputeRow(tr);
    saveDebounced();
  }
  if (t.classList.contains('rationale-input')){
  autosizeRole(t);  // NEW: t·ª± gi√£n
  const tr = t.closest('tr'); if (tr) requireRationaleIfIncluded(tr);
  saveDebounced();
}
});

  tbody.addEventListener('change', e => {
  const t = e.target;
  if (t.classList.contains('score-input')){
    clampTo1to5(t);
    const tr = t.closest('tr'); if (tr) recomputeRow(tr);
    saveDebounced();
  }
  if (t.classList.contains('rationale-input') || t.classList.contains('include-checkbox')){
    const tr = t.closest('tr'); if (tr) requireRationaleIfIncluded(tr);
    saveDebounced();
  }
});


  tbody.addEventListener('wheel', e => {
    if (e.target && e.target.classList.contains('score-input')) e.preventDefault();
  }, { passive:false });

  // ===== NEW: Click th√πng r√°c xo√° d√≤ng (ƒë·∫∑t ƒê√öNG CH·ªñ) =====
  tbody.addEventListener('click', e => {
  const btn = e.target.closest('.btn-del-row');
  if (!btn) return;
  const tr = btn.closest('tr');
  if (tr) {
    tr.remove();
    renumberRows();
    saveDebounced();
  }
});
}

  // ===== NEW: Helpers t·∫°o/xo√°/ƒë√°nh s·ªë d√≤ng =====
function createRow(role = '', index = 0) {
  const tr = document.createElement('tr');
  tr.className = 'border-t align-top';
  tr.innerHTML = `
    <td class="px-3 py-2 text-gray-600 row-index">${index}</td>
<td class="px-3 py-2 align-top">
  <textarea
  class="role-input w-full border rounded-lg px-2 py-1 leading-snug whitespace-pre-wrap break-words resize-none overflow-hidden min-h-[38px]"
  rows="1"
  placeholder="Enter position name...">${role}</textarea>

</td>
    ${[1,2,3,4,5].map(() => `
      <td class="px-2 py-2">
        <input type="number" min="1" max="5" step="1" inputmode="numeric"
               class="score-input w-20 text-center border rounded-lg px-2 py-1" placeholder="1‚Äì5">
      </td>`).join('')}
    <td class="px-3 py-2 text-center font-semibold"><span class="total-cell">‚Äî</span></td>
    <td class="px-3 py-2"><div class="result-pill inline-block px-2 py-1 rounded border text-xs">‚Äî</div></td>
    <td class="px-3 py-2 text-center include-cell"></td>
    <td class="px-3 py-2">
      <div class="space-y-1">
        <textarea
  class="rationale-input w-full border rounded-lg px-2 py-1 leading-snug whitespace-pre-wrap break-words resize-none overflow-hidden min-h-[38px]"
  rows="2"
  placeholder="Add note‚Ä¶"></textarea>
        <p class="rationale-warn hidden text-xs text-red-600">Rationale required when included.</p>
      </div>
    </td>
    <td class="px-3 py-2 text-center">
      <button type="button" class="btn-del-row text-gray-400 hover:text-red-600" title="Delete row">üóëÔ∏è</button>
    </td>
  `;
  recomputeRow(tr);
  return tr;
}

function renumberRows() {
  document.querySelectorAll('#scoreRows tr .row-index').forEach((td, i) => {
    td.textContent = i + 1;
  });
}
// ===== NEW: LocalStorage helpers =====
const STORAGE_PREFIX = 'SP_CALC_V1_';
const getKey = (code) => STORAGE_PREFIX + (code || 'unknown');

function saveState(deptCode){
  const data = [];
  document.querySelectorAll('#scoreRows tr').forEach(tr => {
    const role = tr.querySelector('.role-input')?.value.trim() || '';
    if (!role) return;
    const scores = Array.from(tr.querySelectorAll('.score-input'))
                    .map(i => i.value === '' ? null : Number(i.value));
    const includeCb = tr.querySelector('.include-checkbox');
    const include = includeCb ? !!includeCb.checked : null;
    const rationale = tr.querySelector('.rationale-input')?.value || '';
    data.push({ role, scores, include, rationale });
  });
  try { localStorage.setItem(getKey(document.getElementById('deptSelect')?.value), JSON.stringify(data)); } catch(e){}
}

function loadState(deptCode){
  try {
    const raw = localStorage.getItem(getKey(deptCode));
    if (!raw) return null;
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : null;
  } catch(e){ return null; }
}

function clearState(deptCode){
  try { localStorage.removeItem(getKey(deptCode)); } catch(e){}
}

// Debounce ƒë·ªÉ tr√°nh ghi li√™n t·ª•c
let __saveTimer = null;
function saveDebounced(){
  const code = document.getElementById('deptSelect')?.value;
  if (!code) return;
  clearTimeout(__saveTimer);
  __saveTimer = setTimeout(() => saveState(code), 300);
}
// ===== NEW: Nh·ªõ ph√≤ng ban l·∫ßn cu·ªëi =====
const LAST_DEPT_KEY = 'SP_CALC_LAST_DEPT';

function addRoleRow(roleName = '') {
  const tbody = document.getElementById('scoreRows');
  const tr = createRow(roleName, (tbody.children.length + 1));
  tbody.appendChild(tr);
  const ta = tr.querySelector('.role-input');
if (ta) requestAnimationFrame(() => autosizeRole(ta));
const rat = tr.querySelector('.rationale-input');              // NEW
if (rat) requestAnimationFrame(() => autosizeRole(rat));       // NEW
renumberRows();
saveDebounced();
}

function renderRoles(deptCode){
  const dept = DEPT_MAP[deptCode];
  const rolesFromCSV = dept?.roles || [];
  const tbody = document.getElementById('scoreRows');
  if (!tbody) return;

  const saved = loadState(deptCode);
  tbody.innerHTML = '';

  const rowsToRender = (saved && saved.length) ? saved
                     : rolesFromCSV.map(r => ({ role: r, scores:[null,null,null,null,null], include:null, rationale:'' }));

  rowsToRender.forEach((item, idx) => {
    const tr = createRow(item.role, idx + 1);
    tbody.appendChild(tr);

    // G√°n ƒëi·ªÉm ƒë√£ l∆∞u
    const scoreInputs = tr.querySelectorAll('.score-input');
    (item.scores || []).forEach((v, i) => {
      if (v !== null && scoreInputs[i]) scoreInputs[i].value = v;
    });

    // T√≠nh l·∫°i ƒë·ªÉ hi·ªán Total & Result
    recomputeRow(tr);

    // G√°n include ƒë√£ l∆∞u (n·∫øu c√≥)
    if (item.include === true) {
      const cb = tr.querySelector('.include-checkbox');
      if (cb) cb.checked = true;
    }

    // G√°n rationale ƒë√£ l∆∞u
const rat = tr.querySelector('.rationale-input');
if (rat && item.rationale) rat.value = item.rationale;
// autosize ngay sau khi set value
if (rat) requestAnimationFrame(() => autosizeRole(rat));


    // Autosize Role textarea
    const ta = tr.querySelector('.role-input');
    if (ta) requestAnimationFrame(() => autosizeRole(ta));
  });

  renumberRows();
  requestAnimationFrame(autosizeAllRoles);
}

 // ========= Init =========
  document.addEventListener('DOMContentLoaded', () => {
    attachDelegatedHandlers();
// ===== Add Role + Reset + Dept change
const btnAdd = document.getElementById('btnAddRow');
if (btnAdd) {
  btnAdd.addEventListener('click', () => addRoleRow(''));
}

const btnReset = document.getElementById('btnReset');
if (btnReset){
  btnReset.addEventListener('click', () => {
    const code = document.getElementById('deptSelect')?.value;
    if (!code) return;
    clearState(code);          // xo√° d·ªØ li·ªáu ƒë√£ l∆∞u
    renderRoles(code);         // render l·∫°i t·ª´ CSV/JSON g·ªëc
    requestAnimationFrame(autosizeAllRoles);
  });
}


const deptSelect = document.getElementById('deptSelect');
if (deptSelect){
  deptSelect.addEventListener('change', (e) => {
    const code = e.target.value;
    try { localStorage.setItem(LAST_DEPT_KEY, code); } catch(e){}
    renderRoles(code);                  // ∆∞u ti√™n load t·ª´ LocalStorage n·∫øu c√≥
    requestAnimationFrame(autosizeAllRoles);
  });
}



    loadDeptData(); // n·∫°p d·ªØ li·ªáu ph√≤ng ban
// Khi load xong danh s√°ch dept (hydrateDeptSelect ƒë√£ ƒëi·ªÅn options),
// t·ª± ch·ªçn l·∫°i ph√≤ng ban cu·ªëi c√πng n·∫øu c√≥ v√† render ngay.
const tryRestoreDept = () => {
  const sel = document.getElementById('deptSelect');
  if (!sel || !Object.keys(DEPT_MAP).length) return;

  // 1) l·∫•y dept l·∫ßn cu·ªëi
  let code = null;
  try { code = localStorage.getItem(LAST_DEPT_KEY) || null; } catch(e){}

  // 2) n·∫øu c√≥ v√† t·ªìn t·∫°i trong DEPT_MAP -> set select + render
  if (code && DEPT_MAP[code]) {
    sel.value = code;
    renderRoles(code);
    requestAnimationFrame(autosizeAllRoles);
    return;
  }

  // (t√πy ch·ªçn) n·∫øu mu·ªën auto ch·ªçn dept ƒë·∫ßu ti√™n khi ch∆∞a c√≥ l·ª±a ch·ªçn tr∆∞·ªõc ƒë√≥:
  // const first = Object.keys(DEPT_MAP)[0];
  // if (first) { sel.value = first; renderRoles(first); requestAnimationFrame(autosizeAllRoles); }
};

// V√¨ loadDeptData() l√† async (fetch JSON/CSV), ta ƒë·ª£i m·ªôt "tick" ƒë·ªÉ hydrate xong select:
setTimeout(tryRestoreDept, 0);

  // Export Excel + m·ªü Outlook (n·∫øu checkbox b·∫≠t)
  (function () {
    const btnExport = document.getElementById('btnExportXLSX');
    if (!btnExport) return;

    btnExport.addEventListener('click', () => {
      const deptEl   = document.getElementById('deptSelect');
      const deptKey  = deptEl?.value || 'Department';
      const deptName = (window.DEPT_MAP?.[deptKey]?.name)
                    || (deptEl?.options[deptEl.selectedIndex]?.text)
                    || 'Department';

      // Thu d·ªØ li·ªáu b·∫£ng
      const rows = [];
      let totalRoles = 0;
      let includedCount = 0;

      document.querySelectorAll('#scoreRows tr').forEach(tr => {
        const role = tr.querySelector('.role-input')?.value.trim()
           || tr.querySelector('.role-cell')?.textContent.trim()
           || '';

        if (!role) return;
        totalRoles++;

        const scores = Array.from(tr.querySelectorAll('.score-input')).map(i => i.value || '');
        const total  = tr.querySelector('.total-cell')?.textContent || '';
        const result = tr.querySelector('.result-pill')?.textContent || '';
        const includeCb = tr.querySelector('.include-checkbox');
        const include = includeCb ? (includeCb.checked ? 'Yes' : 'No')
                      : (tr.querySelector('.include-cell')?.textContent.trim() === '‚úñ' ? 'Not allowed (Low)' : '');
        const rationale = tr.querySelector('.rationale-input')?.value || '';

        if (include === 'Yes') includedCount++;

        rows.push({
          Department: deptName,
          Role: role,
          'Succession Urgency (1-5)': scores[0],
          'Cost Efficiency (1-5)':     scores[1],
          'Leadership & Culture (1-5)':scores[2],
          'Strategic Impact (1-5)':    scores[3],
          'Skill Scarcity (1-5)':      scores[4],
          Total: total,
          Result: result,
          'Include in Succession Planning?': include,
          'HoD Adjustment Rationale': rationale
        });
      });

      // T·∫°o file Excel
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(rows);
      XLSX.utils.book_append_sheet(wb, ws, 'Scoring');

      const d  = new Date();
      const y2 = String(d.getFullYear()).slice(-2);
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      const dateCode    = `${y2}${mm}${dd}`;               // v√≠ d·ª• 251009
      const dateDisplay = `${d.getFullYear()}-${mm}-${dd}`; // v√≠ d·ª• 2025-10-09

      const safeDept = deptName.replace(/\s+/g, '_');
      const filename = `Critical_Position_Evaluation_Form_${safeDept}_${dateCode}.xlsx`;

      XLSX.writeFile(wb, filename);

      // M·ªü Outlook n·∫øu ƒë∆∞·ª£c tick
      const openMail = document.getElementById('openEmailCheckbox')?.checked;
      if (!openMail) return;

      setTimeout(() => {
        const to = 'anguyen@ashleyfurniture.com, hphamhong@ashleyfurniture.com';
        const subject = `CVRO ‚Äì Critical Position Scoring (${deptName}, ${dateDisplay})`;

        // So·∫°n email body (plain text nh∆∞ng v·∫´n c√≥ ‚Äúin ƒë·∫≠m‚Äù gi·∫£ l·∫≠p)
        const bodyLines = [
  'Dear team,',
  '',
  `The Critical Position Scoring form for the ${deptName} department has just been finalized and exported on ${dateDisplay}.`,
  '',
  `‚Ä¢ Total roles evaluated: ${totalRoles}`,
  `‚Ä¢ Roles included in succession planning: ${includedCount}`,
  '',
  `‚ö†Ô∏è IMPORTANT‚ö†Ô∏è: Please attach the file below (downloaded automatically) before sending.`,
  `File: ${filename}`,
  '',
  'Thank you,',
  deptName
];

const bodyPlain = bodyLines.join('\r\n');

// T·∫°o mailto URL
const mailto =
  `mailto:${encodeURIComponent(to)}`
  + `?subject=${encodeURIComponent(subject)}`
  + `&body=${encodeURIComponent(bodyPlain)}`;

window.location.href = mailto;
      }, 500);
    });
  })();
  // ====== N√∫t Email AHR (m·ªü so·∫°n email t·ª± ƒë·ªông) ======
const btnEmail = document.getElementById('btnEmailAHR');
if (btnEmail){
  btnEmail.addEventListener('click', () => {
    const deptEl   = document.getElementById('deptSelect');
    const deptKey  = deptEl?.value || 'Department';
    const deptName = (window.DEPT_MAP?.[deptKey]?.name)
                  || (deptEl?.options[deptEl.selectedIndex]?.text)
                  || 'Department';

    // ƒê·∫øm t·ªïng roles & s·ªë role ƒë∆∞·ª£c tick include
    let totalRoles = 0, includedCount = 0;
    document.querySelectorAll('#scoreRows tr').forEach(tr => {
  const role = tr.querySelector('.role-input')?.value.trim()
              || tr.querySelector('.role-cell')?.textContent.trim()
              || '';
  if (!role) return;
  totalRoles++;
  const cb = tr.querySelector('.include-checkbox');
  if (cb && cb.checked) includedCount++;
});

    // T·∫°o c√°c bi·∫øn ng√†y & t√™n file (tr√πng v·ªõi export)
    const d  = new Date();
    const y2 = String(d.getFullYear()).slice(-2);
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    const dateDisplay = `${d.getFullYear()}-${mm}-${dd}`;
    const safeDept = deptName.replace(/\s+/g, '_');
    const filename = `Critical_Position_Evaluation_Form_${safeDept}_${y2}${mm}${dd}.xlsx`;

    // Mailto
    const to = 'anguyen@ashleyfurniture.com, hphamhong@ashleyfurniture.com';
    const subject = `CVRO ‚Äì Critical Position Scoring (${deptName}, ${dateDisplay})`;

    // L∆∞u √Ω: mailto th∆∞·ªùng l√† plain text; bold HTML c√≥ th·ªÉ b·ªã b·ªè qua trong Outlook.
    const body = [
      'Dear team,',
      '',
      `The Critical Position Scoring form for the ${deptName} department has just been finalized and exported on ${dateDisplay}.`,
      '',
      `‚Ä¢ Total roles evaluated: ${totalRoles}`,
      `‚Ä¢ Roles included in succession planning: ${includedCount}`,
      '',
      '‚ö†Ô∏èIMPORTANT‚ö†Ô∏è: Please attach the file below before sending. (You may remove this line after attaching.)',
      `File: ${filename}`,
      '',
      'Thank you,',
      deptName
    ].join('\r\n');

    const mailto =
      `mailto:${encodeURIComponent(to)}`
      + `?subject=${encodeURIComponent(subject)}`
      + `&body=${encodeURIComponent(body)}`;

    window.location.href = mailto;
  });
}
  // g·ªçi autosize khi to√†n trang load xong (ch·∫Øc ch·∫Øn hi·ªÉn th·ªã ƒë·ªß)
  window.addEventListener('load', autosizeAllRoles);
});
</script>
</div>
<!-- CTA: Final Forms (Part A) -->
<div class="mt-6 bg-orange-50 border border-orange-200 rounded-xl px-5 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
  
  <!-- C·ªôt tr√°i: Ti√™u ƒë·ªÅ + m√¥ t·∫£ -->
  <div class="flex-1">
    <div class="font-semibold text-gray-900 flex items-center gap-2 flex-wrap">
      <span>üìä Final Forms ‚Äì Critical Position Evaluation</span>
      <span class="text-xs px-2 py-0.5 rounded-full border border-orange-200 bg-white text-ashley-orange whitespace-nowrap">
        üîí HoD Access Only
      </span>
    </div>
    <div class="text-xs text-gray-600 mt-1">
      SharePoint folder containing all finalized evaluation forms exported after HoD confirmation.
      Visible only to each department.
    </div>
  </div>

  <!-- C·ªôt ph·∫£i: N√∫t -->
	<a
	  data-link-id="stage1a_final_forms_folder"
	  href="#"
	  target="_blank"
	  class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm bg-ashley-orange text-white hover:bg-ashley-orange-dark transition whitespace-nowrap"
	>
	  üìÅ Open Folder
	</a>
</div>
</div>

<!-- Part B: Define Success Profile for Selected Positions -->
<div id="s1-profile-tab" class="step-tab-content hidden">
  <div class="mb-4">
    <p class="font-semibold text-gray-700 text-base mb-2">
      Each department must review and finalize the Success Profile for each selected role intended for succession planning.
    </p>
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
      <div class="flex items-center gap-2">
        <span class="bg-ashley-orange text-white px-2 py-1 rounded text-xs font-bold">EXAMPLE</span>
        <span class="text-yellow-800 font-medium">The content below is an example for the position of Senior Team Leader of Human Resources under the Asia Human Resources department.</span>
      </div>
    </div>
  </div>

  <!-- ================== Section 1 (STATIC) ================== -->
  <section id="sec-competency" class="border-2 border-gray-300 rounded-xl bg-white example-watermark">
    <div class="px-5 py-4 border-b-2 border-gray-200">
      <h3 class="text-ashley-orange font-extrabold text-lg">Section 1: Competency Requirements</h3>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-[1100px] w-full text-sm">
        <thead class="bg-gray-50">
          <tr class="text-gray-800">
            <th class="px-3 py-3 text-left w-20">Areas</th>
            <th class="px-3 py-3 text-left w-12">No.</th>
            <th class="px-3 py-3 text-left w-20">Competency Name</th>
            <th class="px-3 py-3 text-left w-50">Competency Description</th>
            <th class="px-3 py-3 text-left w-30">Evaluation Item (Job Skills)</th>
            <th class="px-3 py-3 text-left w-[22rem]">Item Description</th>
          </tr>
        </thead>

        <tbody class="align-top">
          <!-- ===== Business/Management Skills (3) ===== -->
          <tr>
            <td class="border-t px-3 py-2 font-medium area-cell" rowspan="3">Business/Management Skills</td>
            <td class="border-t px-3 py-2">1</td>
            <td class="border-t px-3 py-2">Business Knowledge</td>
            <td class="border-t px-3 py-2">Understands business drivers; evaluates proposals; spots data gaps that need deeper analysis.</td>
            <td class="border-t px-3 py-2">Analyze a proposal</td>
            <td class="border-t px-3 py-2">Review a real case and identify key levers, risks, and assumptions.</td>
          </tr>
          <tr>
            <td class="border-t px-3 py-2">2</td>
            <td class="border-t px-3 py-2">Customer Orientation</td>
            <td class="border-t px-3 py-2">Discovers and meets customer needs; balances cost, quality, time for win-win outcomes.</td>
            <td class="border-t px-3 py-2">Customer scenario</td>
            <td class="border-t px-3 py-2">Role-play handling a priority conflict while maintaining SLA.</td>
          </tr>
          <tr>
            <td class="border-t px-3 py-2">3</td>
            <td class="border-t px-3 py-2">Operational Excellence</td>
            <td class="border-t px-3 py-2">Applies best practices; drives continuous improvement to efficiency and quality.</td>
            <td class="border-t px-3 py-2">Kaizen mini-case</td>
            <td class="border-t px-3 py-2">Map a process, propose waste reduction and measurable KPIs.</td>
          </tr>

          <!-- ===== Interpersonal Effectiveness (3) ===== -->
          <tr>
            <td class="border-t px-3 py-2 font-medium area-cell" rowspan="3">Interpersonal Effectiveness</td>
            <td class="border-t px-3 py-2">1</td>
            <td class="border-t px-3 py-2">Stakeholder Communication</td>
            <td class="border-t px-3 py-2">Communicates clearly and on time; tailors messages to audience; aligns expectations.</td>
            <td class="border-t px-3 py-2">Executive update</td>
            <td class="border-t px-3 py-2">Deliver a 3-slide status with risk/mitigation; assess clarity & influence.</td>
          </tr>
          <tr>
            <td class="border-t px-3 py-2">2</td>
            <td class="border-t px-3 py-2">Conflict Resolution</td>
            <td class="border-t px-3 py-2">Addresses disagreement constructively; seeks common ground and commitments.</td>
            <td class="border-t px-3 py-2">Mediation role-play</td>
            <td class="border-t px-3 py-2">Facilitate two parties to an agreed next step and timeline.</td>
          </tr>
          <tr>
            <td class="border-t px-3 py-2">3</td>
            <td class="border-t px-3 py-2">Cross-functional Collaboration</td>
            <td class="border-t px-3 py-2">Builds trust with other teams; shares context; co-creates solutions.</td>
            <td class="border-t px-3 py-2">Joint planning</td>
            <td class="border-t px-3 py-2">Draft a RACI &amp; sprint plan with another function; evaluate feasibility.</td>
          </tr>

          <!-- ===== Personal Attributes (2) ===== -->
          <tr>
            <td class="border-t px-3 py-2 font-medium area-cell" rowspan="2">Personal Attributes</td>
            <td class="border-t px-3 py-2">1</td>
            <td class="border-t px-3 py-2">Ownership &amp; Accountability</td>
            <td class="border-t px-3 py-2">Takes responsibility; follows through; learns from mistakes and prevents recurrence.</td>
            <td class="border-t px-3 py-2">Post-mortem review</td>
            <td class="border-t px-3 py-2">Write an RCA (5-Whys) and prevention actions with owners/due dates.</td>
          </tr>
          <tr>
            <td class="border-t px-3 py-2">2</td>
            <td class="border-t px-3 py-2">Resilience</td>
            <td class="border-t px-3 py-2">Stays composed under pressure; adapts priorities; maintains performance.</td>
            <td class="border-t px-3 py-2">Stress scenario</td>
            <td class="border-t px-3 py-2">Plan workload re-prioritization and stakeholder comms for a sudden change.</td>
          </tr>

          <!-- ===== Leadership Impact (2) ===== -->
          <tr>
            <td class="border-t px-3 py-2 font-medium area-cell" rowspan="2">Leadership Impact</td>
            <td class="border-t px-3 py-2">1</td>
            <td class="border-t px-3 py-2">Team Leadership</td>
            <td class="border-t px-3 py-2">Sets direction; coaches performance; builds an inclusive, high-standards culture.</td>
            <td class="border-t px-3 py-2">Coaching plan</td>
            <td class="border-t px-3 py-2">Create a 90-day plan: goals, feedback rhythm, growth actions.</td>
          </tr>
          <tr>
            <td class="border-t px-3 py-2">2</td>
            <td class="border-t px-3 py-2">Strategic Thinking</td>
            <td class="border-t px-3 py-2">Connects initiatives to business strategy; anticipates risks and opportunities.</td>
            <td class="border-t px-3 py-2">Strategy brief</td>
            <td class="border-t px-3 py-2">Draft OKRs aligned to company priorities; outline risk mitigations.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Conclusion note -->
    <div class="px-5 py-4 border-t-2 border-gray-200 bg-yellow-50 rounded-b-xl">
      <p class="text-sm text-gray-800">
        <span class="font-semibold">Available in the Performance Evaluation System:</span>
        Review &amp; finalize the competency requirements of the successor role, including both leadership competencies and technical skills.
      </p>
    </div>
  </section>

  <!-- ================== Section 2 (STATIC) ================== -->
  <section id="sec-qualifications" class="border-2 border-gray-300 rounded-xl bg-white mt-6 example-watermark">
    <div class="px-5 py-4 border-b-2 border-gray-200">
      <h3 class="text-blue-700 font-extrabold text-lg">Section 2: Job Qualifications</h3>
    </div>

    <div class="p-5 grid md:grid-cols-2 gap-6 text-sm">
      <div>
        <label class="block font-medium">Years of Experience Required</label>
        <p class="text-xs text-gray-500 mt-1">Minimum years of relevant experience.</p>
        <p class="mt-2 px-3 py-2 bg-white rounded border">7‚Äì10 years of progressive HR experience, including at least 3 years in a supervisory role</p>
      </div>

      <div>
        <label class="block font-medium">Educational Background (if any)</label>
        <p class="text-xs text-gray-500 mt-1">Required degree(s) and field(s).</p>
        <p class="mt-2 px-3 py-2 bg-white rounded border">Bachelor‚Äôs degree in Human Resources, Business Administration, or related field; MBA preferred.</p>
      </div>

      <div>
        <label class="block font-medium">Certifications (if any)</label>
        <p class="text-xs text-gray-500 mt-1">Any industry or function-related certifications required.</p>
        <p class="mt-2 px-3 py-2 bg-white rounded border">SHRM-CP/SHRM-SCP, CIPD Level 5/7, or equivalent HR certification preferred.</p>
      </div>

      <div>
        <label class="block font-medium">Functional/Technical Knowledge</label>
        <p class="text-xs text-gray-500 mt-1">Systems, tools, or processes required.</p>
        <p class="mt-2 px-3 py-2 bg-white rounded border">Knowledge of HRIS systems (SAP SuccessFactors, Workday), labor law compliance, performance management processes, and talent development frameworks.</p>
      </div>

      <div>
        <label class="block font-medium">Language/Communication Skills</label>
        <p class="text-xs text-gray-500 mt-1">Requirements for English level, reporting ability, or customer-facing communication.</p>
        <p class="mt-2 px-3 py-2 bg-white rounded border">Fluent in English and Vietnamese ‚Äì strong presentation, reporting, and cross-cultural communication skills.</p>
      </div>

      <div>
        <label class="block font-medium">Other Role-Specific Requirements</label>
        <p class="text-xs text-gray-500 mt-1">Include availability to travel, shift flexibility, domain knowledge, etc.</p>
        <p class="mt-2 px-3 py-2 bg-white rounded border">Ability to travel across Asia sites, strong stakeholder management, experience in multicultural environment.</p>
      </div>
    </div>

    <div class="px-5 py-4 border-t-2 border-gray-200 bg-yellow-50 rounded-b-xl">
      <p class="text-sm text-gray-800">
        <span class="font-semibold">Available in departmental JDs: </span>
        Review the essential Job qualifications. This section must be reviewed and consolidated into the template
      </p>
    </div>
  </section>

<!-- CTA: Success Profile Templates (Part B) -->
<div class="mt-6 bg-orange-50 border border-orange-200 rounded-xl px-5 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">

  <!-- C·ªôt tr√°i: Ti√™u ƒë·ªÅ + badge + m√¥ t·∫£ -->
	<div class="flex-1">
	  <div class="font-semibold text-gray-900 flex items-center gap-3 flex-wrap">
	    <span>üë§ Success Profile ‚Äì Department Templates (2025)</span>
		<span id="sp-badge"
	      class="text-xs px-2 py-0.5 rounded-full border border-orange-200 bg-white text-ashley-orange whitespace-nowrap">
	      ‚è≥ HoD Action ‚Äì Opens Soon
	    </span>
	  </div>
	  <div class="text-xs text-gray-600 mt-1">
	    Success Profile templates for prioritized roles in Part A ‚Äî to be reviewed by HoDs as guided in the Success Profile tab.
	  </div>
	</div>

  <!-- C·ªôt ph·∫£i: N√∫t (ƒë·∫∑t data-link-id theo CSV) -->
	<a id="sp-btn"
	   data-link-id="stage1b_success_profile_templates_folder"
	   href="#"
	   class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm bg-gray-200 text-gray-500 cursor-not-allowed select-none transition whitespace-nowrap"
	   title="This link will be activated after the unlock time">
	  üìÅ Open Folder
	</a>
	</div>

	<!-- Auto-unlock script -->
	<script>
	document.addEventListener("DOMContentLoaded", () => {
	  (async () => {
	    const btn   = document.getElementById("sp-btn");
	    const badge = document.getElementById("sp-badge");
	    if (!btn || !badge) return;
	
	    // ‚è≥ Ch·ªù cho t·ªõi khi CSV ƒë∆∞·ª£c n·∫°p v√† c√°c link ƒë√£ g·∫Øn xong
	    await window.linksReady;
	
	    // L·∫•y link t·ª´ CSV d·ª±a v√†o data-link-id
	    const csvHref = btn.getAttribute("href");
	
	    // C·∫•u h√¨nh unlock
	    const unlockDate   = new Date("2025-10-20T13:00:00+07:00");//gi·ªù c·ªßa Success Profile
	    const forceByHash  = window.location.hash.includes("unlockSP");
	    const forceByLocal = localStorage.getItem("sp_force_open") === "1";
	    const shouldOpen   = (new Date() >= unlockDate) || forceByHash || forceByLocal;
	
	    // Ch·∫∑n click khi c√≤n kh√≥a
	    btn.addEventListener("click", e => {
	      if (!shouldOpen || !csvHref || csvHref === "#") e.preventDefault();
	    });
	
	    if (shouldOpen && csvHref && csvHref !== "#") {
	      // ‚úÖ B·∫≠t n√∫t b·∫±ng link l·∫•y t·ª´ CSV
	      btn.setAttribute("target", "_blank");
	      btn.classList.remove("bg-gray-200","text-gray-500","cursor-not-allowed","select-none");
	      btn.classList.add("bg-ashley-orange","text-white","hover:bg-ashley-orange-dark","transition");
	      btn.removeAttribute("title");
	
	      badge.textContent = "‚úÖ HoD Action ‚Äì Now Open";
	      badge.classList.remove("bg-orange-50","border-orange-200","text-ashley-orange");
	      badge.classList.add("bg-green-50","border-green-200","text-green-700");
	    } else {
	      // üîí Gi·ªØ tr·∫°ng th√°i kh√≥a
	      btn.setAttribute("href", "#");
	      btn.setAttribute("title", "This link will be activated after the unlock time");
	      badge.textContent = "‚è≥ HoD Action ‚Äì Opens soon";
	    }
	  })();
	});
	</script>
</div>

<!-- ===== Watermark CSS (KEEP) ===== -->
<style>
  #sec-competency.example-watermark,
  #sec-qualifications.example-watermark { position: relative; }
  #sec-competency.example-watermark::before,
  #sec-qualifications.example-watermark::before {
    content: "EXAMPLE";
    position: absolute;
    inset: 0;
    pointer-events: none;
    font-weight: 700;
    font-size: clamp(3rem, 12vw, 8rem);
    line-height: 1;
    letter-spacing: 0.15em;
    color: rgba(246, 140, 44, 0.10);
    text-shadow: 0 0 10px rgba(246, 140, 44, 0.10);
    display: grid;
    place-items: center;
    transform: rotate(-18deg);
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const ex = [...document.querySelectorAll('#s1-profile-tab span')].find(s => s.textContent.trim().toUpperCase()==='EXAMPLE');
    if (ex) ex.classList.add('ring-2','ring-ashley-orange','animate-pulse');
  });
</script>
</div>
</div>
<!-- STAGE 2 ‚Äì Identify Talent Pool (Collapsible style, 3 colorful rounds) -->
<div id="step-2" class="step-content hidden">
          <div class="bg-white rounded-xl border p-6 mb-6">
  <h3 class="text-2xl font-bold text-gray-900 mb-2">STAGE 2: Identify Talent Pool</h3>
  <p class="text-gray-600 mb-6">To <strong> identifies the Talent Pool through 3 structured rounds. </strong> It ensures fairness and transparency, empowers employees to take initiative, and confirms the right fit for succession planning.</p>
	
<!-- ROUND 1 -->
<details class="group bg-green-50 border-l-4 border-green-500 rounded-r-lg mb-4">
  <summary class="flex items-center justify-between cursor-pointer select-none px-5 py-3">
    <span class="font-semibold text-green-700 text-base flex items-center gap-2">
      üß© Round 1 ‚Äì HoD Nomination
    </span>
    <svg class="h-5 w-5 text-green-600 transition-transform duration-200 ease-out group-open:rotate-90">
      <path fill="currentColor"
        d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.12l3.71-2.89a.75.75 0 1 1 1.04 1.08l-4.24 3.31a.75.75 0 0 1-.93 0L5.21 8.31a.75.75 0 0 1 .02-1.1z" />
    </svg>
  </summary>

  <div class="px-5 pb-4 pt-1 text-sm text-gray-800">
    <p class="mb-2">
      AHR filters employees using the <span class="font-medium">9-Box Grid</span> from the 2025 Performance Evaluation and shares the
      <strong>Green Zone list</strong> with each HoD for nomination.
    </p>

    <!-- === 9-Box + Group 1 & 2 visual layout === -->
    <div class="mt-4 bg-white rounded-xl border p-4">
      <div class="grid md:grid-cols-5 gap-4">
        <!-- Left: 9-Box thumbnail (optional) -->
        <div class="md:col-span-2">
          <img src="./assets/9box_sample.png" alt="9-Box Grid"
               class="w-full h-auto rounded-lg border shadow-sm object-cover">
        </div>

        <!-- Right: Group cards -->
        <div class="md:col-span-3 space-y-4">

          <!-- Group 1 - Green Zone -->
          <div class="rounded-lg border border-emerald-500">
            <div class="bg-emerald-500 text-white rounded-t-lg px-4 py-2">
              <h5 class="font-semibold">
                Group 1 ‚Äì Green Zone
                <span class="opacity-90 font-normal">(Superstar, High Professional, Rising Star)</span>
              </h5>
            </div>
            <div class="bg-white rounded-b-lg px-4 py-3 border-t border-emerald-200">
              <p class="text-gray-800">
                Employees with <span class="font-semibold">above-average performance/competency</span> scores.
                Suggested as <span class="text-emerald-700 font-semibold">priority for Talent Pool</span> consideration.
              </p>
            </div>
          </div>

          <!-- Group 2 - Blue Zone -->
          <div class="rounded-lg border border-blue-700">
            <div class="bg-blue-700 text-white rounded-t-lg px-4 py-2">
              <h5 class="font-semibold">
                Group 2 ‚Äì Blue Zone
                <span class="opacity-90 font-normal">(Valued Contributor)</span>
              </h5>
            </div>
            <div class="bg-white rounded-b-lg px-4 py-3 border-t border-blue-200">
              <p class="text-gray-800">
                Employees who may be considered if they show <span class="font-semibold">outstanding traits</span>,
                <span class="font-semibold">strong learning agility</span>, and <span class="font-semibold">ambition for growth</span>.
                Suggested as <span class="text-blue-700 font-semibold">optional pool</span> if needed.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- === End Group layout === -->

    <div class="bg-white border border-green-200 rounded-lg p-3 text-sm mt-4">
      <p class="text-gray-700">
        <strong>Guidelines:</strong> HoDs will receive only the Green Zone list and may tick nominees for Round 2 directly.
        If they wish to include additional names from Blue Zone, rationale must be provided.  
        Exclusion of Green Zone names does not require justification, but AHR recommends that no rationale be related to gender,
        pregnancy, or any other personal factor.
      </p>
    </div>

    <p class="mt-3 text-gray-700">
      HoDs use the <strong>Pre-Nomination Checklist</strong> and <strong>Candidate List</strong> to finalize the nomination.
      This step acts as a <em>pre-screening stage</em> to identify employees with development potential before the self-application phase.
    </p>
	<!-- === ROUND 1 ‚Äì Successor Pre-Nomination (centered button text) === -->
<div class="bg-orange-50 border border-orange-200 rounded-lg px-4 py-3 mt-4">
  <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-3">
    <!-- Left column -->
    <div class="flex-1">
      <div class="font-semibold text-gray-900 flex items-center gap-2 flex-wrap text-sm">
        <span class="text-base">üìã</span>
        <span>Successor Pre-Nomination Checklist &amp; Candidate List</span>
        <span id="r1-badge-open"
              class="text-xs px-2 py-0.5 rounded-full border border-orange-200 bg-white text-ashley-orange whitespace-nowrap">
          ‚è≥ HoD Action ‚Äì Opens soon
        </span>
      </div>

      <p class="text-xs text-gray-600 mt-1 leading-snug md:max-w-[80%]">
        Includes one example file for HoDs to preview and a SharePoint folder containing all Green-Zone candidate lists. 
        The folder link will unlock after the performance evaluation is finalized; in the meantime, HoDs may review the example file as needed.
      </p>
    </div>

    <!-- Right column (stacked buttons, centered text) -->
    <div class="w-auto Auto-width shrink-0">
      <div class="flex flex-col gap-1.5">
        <!-- Always-open example (CSV id: rround2_ms_form) -->
        <a 
           data-link-id="rround2_ms_form"
           href="#"
           target="_blank"
           class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg text-sm
                  bg-green-600 text-white hover:bg-green-700 transition whitespace-nowrap w-auto text-center">
          üìÑ View Example File
        </a>

        <!-- Timed-open folder (CSV id: round1_department) -->
        <a id="r1-folder-btn"
           data-link-id="round1_department"
           href="#"
           class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg text-sm
                  bg-gray-200 text-gray-500 cursor-not-allowed select-none transition whitespace-nowrap w-auto text-center"
           title="This link will be activated after the unlock time">
          üìÅ Open Folder
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Unlock script (same logic as before) -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  (async () => {
    const btnFolder = document.getElementById("r1-folder-btn");
    const btnEx     = document.getElementById("r1-example-btn");
    const badgeOpen = document.getElementById("r1-badge-open");
    if (!btnFolder || !btnEx || !badgeOpen) return;

    await (window.linksReady || Promise.resolve());
    const folderHref = btnFolder.getAttribute("href");
    const exHref     = btnEx.getAttribute("href");

    if (!exHref || exHref === "#") btnEx.addEventListener("click", e => e.preventDefault());
    else btnEx.setAttribute("target", "_blank");

    const unlockDate   = new Date("2025-10-20T13:00:00+07:00");// gi·ªù c·ªßa round 1
    const forceByHash  = window.location.hash.includes("unlockR1");
    const forceByLocal = localStorage.getItem("r1_force_open") === "1";
    const shouldOpen   = (new Date() >= unlockDate) || forceByHash || forceByLocal;

    btnFolder.addEventListener("click", e => {
      if (!shouldOpen || !folderHref || folderHref === "#") e.preventDefault();
    });

    if (shouldOpen && folderHref && folderHref !== "#") {
      btnFolder.setAttribute("target", "_blank");
      btnFolder.classList.remove("bg-gray-200","text-gray-500","cursor-not-allowed","select-none");
      btnFolder.classList.add("bg-ashley-orange","text-white","hover:bg-ashley-orange-dark");
      btnFolder.removeAttribute("title");

      badgeOpen.textContent = "‚úÖ HoD Action ‚Äì Now Open";
      badgeOpen.classList.remove("bg-white","border-orange-200","text-ashley-orange");
      badgeOpen.classList.add("bg-green-50","border-green-200","text-green-700");
    } else {
      btnFolder.setAttribute("href", "#");
      badgeOpen.textContent = "‚è≥HoD Action ‚Äì Opens soon";
    }
  })();
});
</script>

</div>
</details>

  <!-- ROUND 2 -->
  <details class="group bg-blue-50 border-l-4 border-blue-500 rounded-r-lg mb-4">
    <summary class="flex items-center justify-between cursor-pointer select-none px-5 py-3">
      <span class="font-semibold text-blue-700 text-base flex items-center gap-2">
        üìù Round 2 ‚Äì Candidate Self-Application
      </span>
      <svg class="h-5 w-5 text-blue-600 transition-transform duration-200 ease-out group-open:rotate-90">
        <path fill="currentColor"
          d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.12l3.71-2.89a.75.75 0 1 1 1.04 1.08l-4.24 3.31a.75.75 0 0 1-.93 0L5.21 8.31a.75.75 0 0 1 .02-1.1z" />
      </svg>
    </summary>

    <div class="px-5 pb-4 pt-1 text-sm text-gray-800">
      <ul class="list-disc pl-5 space-y-1 mb-3">
        <li>HoD-nominated employees are invited by AHR to apply via online MS Form.</li>
        <li>Applicants must complete the <strong>Candidate Profile Template</strong>, including:</li>
      </ul>

<!-- ====== ROUND 2 ‚Äì Candidate Self-Application (Final, no detailed instruction list) ====== -->
<div class="bg-white border border-blue-200 rounded-xl p-5 text-sm">

  <!-- Header controls -->
  <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
    <div class="flex flex-wrap items-center gap-2">
      <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">1. üë§ Basic Info</span>
      <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">2. üóÇÔ∏è Preferences</span>
      <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">3. ‚ùì Reason</span>
      <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">4. üß≠ Role Qs</span>
      <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">5. üöö Mobility</span>
      <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">6. ‚ö° Aspiration</span>
    </div>

    <div class="flex items-center gap-2">
      <button type="button"
        class="px-3 py-1.5 rounded-lg border border-blue-300 text-blue-700 hover:bg-blue-50"
        onclick="showInstructions()">Show Instructions</button>

      <!-- Show Example menu -->
      <div class="relative">
        <button id="exampleBtn" onclick="toggleMenu()" class="px-3 py-1.5 rounded-lg border border-blue-300 text-blue-700 hover:bg-blue-50 flex items-center gap-1">
          Show Example
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div id="exampleMenu" class="hidden absolute right-0 mt-1 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-10">
          <button onclick="loadExample('pd')" class="w-full text-left px-4 py-2 text-sm hover:bg-blue-50">Product Development</button>
          <button onclick="loadExample('qa')" class="w-full text-left px-4 py-2 text-sm hover:bg-blue-50">Quality Assurance</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Info panel (short message only) -->
  <div id="infoPanel" class="mb-4 rounded-lg border border-blue-200 bg-blue-50 p-4 text-xs text-blue-900">
    <div class="font-semibold mb-1">Instructions</div>
    Fill in each section carefully and completely. Use the <strong>SBI (Situation‚ÄìBehavior‚ÄìImpact)</strong> format to support your examples whenever possible.
  </div>

  <!-- ===== ROW 1: Basic Info | Role-Specific Questions ===== -->
  <div class="md:flex gap-4 mb-4">
    <!-- Basic Info -->
    <div class="flex-1">
      <div class="h-full border rounded-lg p-4">
        <div class="flex items-center gap-2 mb-2"><span>üë§</span><h4 class="font-semibold text-gray-900">Basic Info</h4></div>
        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
          <div><dt class="text-gray-500">Full name</dt><dd id="bi-name" class="font-medium text-gray-900">‚Äî</dd></div>
          <div><dt class="text-gray-500">Department</dt><dd id="bi-dept" class="font-medium text-gray-900">‚Äî</dd></div>
          <div class="sm:col-span-2"><dt class="text-gray-500">Current role</dt><dd id="bi-role" class="font-medium text-gray-900">‚Äî</dd></div>
        </dl>
      </div>
    </div>

    <!-- Role-Specific Questions with tabs -->
    <div class="flex-1">
      <div class="h-full border rounded-lg p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <span>üß≠</span><h4 class="font-semibold text-gray-900">Role-Specific Questions</h4>
          </div>
          <!-- mini tabs -->
          <div id="roleTabs" class="flex rounded-lg overflow-hidden border">
            <button id="tabMgr" type="button"
              class="px-3 py-1 text-xs font-medium bg-blue-600 text-white"
              onclick="setRoleTab('mgr')">Managerial</button>
            <button id="tabIC" type="button"
              class="px-3 py-1 text-xs font-medium bg-white text-blue-700"
              onclick="setRoleTab('ic')">Non-managerial</button>
          </div>
        </div>

        <!-- Managerial panel -->
        <div id="panelMgr" class="space-y-3">
          <p class="text-gray-800">
            <span class="font-semibold">Leadership Style & Team Motivation:</span> Describe how you lead and inspire others to achieve shared goals. Explain how you communicate direction, build trust, and maintain motivation and accountability within your team
          </p>
          <div id="mgrAnswers" class="space-y-2 text-gray-800"></div>
          <div class="bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-800">
            Tip: Use a recent example that demonstrates how you guided your team, resolved challenges, and celebrated results.
          </div>
        </div>

        <!-- Non-managerial panel -->
        <div id="panelIC" class="space-y-3 hidden">
          <p class="text-gray-800">
            <span class="font-semibold">Technical Expertise & Problem-Solving:</span> Describe the key technical skills that make you effective in your role and how you apply them to overcome complex work challenges.
          </p>
          <div id="icAnswers" class="space-y-2 text-gray-800"></div>
          <div class="bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-800">
            Tip: Highlight specific tools, methods, or examples that show your ability to solve problems and deliver practical results.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ROW 2: Preferences | Mobility ===== -->
  <div class="md:flex gap-4 mb-4">
    <!-- Preferences -->
    <div class="flex-1 relative">
      <div class="h-full border rounded-lg p-4">
        <div class="flex items-center gap-2 mb-2"><span>üóÇÔ∏è</span><h4 class="font-semibold text-gray-900">Succession Preferences</h4></div>
        <div id="onePrefBadge" class="hidden absolute top-3 right-4 bg-blue-100 text-blue-800 text-[11px] font-medium px-2 py-0.5 rounded-full border border-blue-200">Only 1 preference provided</div>
        <p class="text-xs text-gray-600 mb-3">
          You may list <span class="font-medium">one or two</span> preferences. If two, at least one must be in your current department (either 1st or 2nd).
        </p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div class="bg-blue-50/60 border border-blue-200 rounded-lg p-3">
            <div class="text-xs text-blue-700 mb-1 font-semibold">1st Preference</div>
            <div id="pref1" class="font-medium text-gray-900">‚Äî</div>
          </div>
          <div class="bg-blue-50/60 border border-blue-200 rounded-lg p-3 relative">
            <div class="text-xs text-blue-700 mb-1 font-semibold">2nd Preference</div>
            <div id="pref2" class="font-medium text-gray-900">‚Äî</div>
            <div id="crossNotice" class="hidden absolute top-2 right-2 bg-yellow-100 text-yellow-700 text-[10px] px-2 py-0.5 rounded-full">Cross-Dept</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobility -->
    <div class="flex-1">
      <div class="h-full border rounded-lg p-4">
        <div class="flex items-center gap-2 mb-2"><span>üöö</span><h4 class="font-semibold text-gray-900">Mobility & Availability</h4></div>
        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
          <div><dt class="text-gray-500">Willing to relocate?</dt><dd id="mob-relocate" class="font-medium text-gray-900">‚Äî</dd></div>
          <div><dt class="text-gray-500">Open to change dept?</dt><dd id="mob-change" class="font-medium text-gray-900">‚Äî</dd></div>
        </dl>
      </div>
    </div>
  </div>

  <!-- ===== ROW 3: Reason | Aspiration ===== -->
  <div class="md:flex gap-4">
    <div class="flex-1">
      <div class="h-full border rounded-lg p-4">
        <div class="flex items-center gap-2 mb-2"><span>‚ùì</span><h4 class="font-semibold text-gray-900">Reason for Each Preference</h4></div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div><div class="text-xs text-gray-500 mb-1">Reason (1st)</div><p id="rs1" class="text-gray-800">‚Äî</p></div>
          <div><div class="text-xs text-gray-500 mb-1">Reason (2nd)</div><p id="rs2" class="text-gray-800">‚Äî</p></div>
        </div>
      </div>
    </div>

    <div class="flex-1">
      <div class="h-full border rounded-lg p-4">
        <div class="flex items-center gap-2 mb-2"><span>‚ö°</span><h4 class="font-semibold text-gray-900">Career Aspiration & Motivation</h4></div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div><div class="text-xs text-gray-500 mb-1">Short-term (1 year)</div><p id="asp-short" class="text-gray-800">‚Äî</p></div>
          <div><div class="text-xs text-gray-500 mb-1">Mid-term (2‚Äì3 years)</div><p id="asp-mid" class="text-gray-800">‚Äî</p></div>
        </div>
	    <div class="bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-800 mt-3">
			<p>Note: This program is a <strong>Talent Development initiative</strong> (not a promotion program).</p>
	 		<p class="mt-1">Preferences will be visible to relevant HoDs for career discussion & alignment.</p>
		</div>
      </div>
    </div>
  </div>
</div>
<script>
/* ===== Helpers ===== */
function toggleMenu(){ document.getElementById('exampleMenu').classList.toggle('hidden'); }
function setText(id, val){ document.getElementById(id).innerText = (val && String(val).trim()) ? val : '‚Äî'; }

/* Tabs */
function setRoleTab(mode){
  const mgr = document.getElementById('panelMgr');
  const ic  = document.getElementById('panelIC');
  const tMgr = document.getElementById('tabMgr');
  const tIC  = document.getElementById('tabIC');
  if(mode === 'mgr'){
    mgr.classList.remove('hidden'); ic.classList.add('hidden');
    tMgr.classList.add('bg-blue-600','text-white'); tMgr.classList.remove('bg-white','text-blue-700');
    tIC.classList.add('bg-white','text-blue-700');  tIC.classList.remove('bg-blue-600','text-white');
  }else{
    ic.classList.remove('hidden'); mgr.classList.add('hidden');
    tIC.classList.add('bg-blue-600','text-white'); tIC.classList.remove('bg-white','text-blue-700');
    tMgr.classList.add('bg-white','text-blue-700'); tMgr.classList.remove('bg-blue-600','text-white');
  }
}

/* Show Instructions (reset) */
function showInstructions(){
  // header h∆∞·ªõng d·∫´n
  document.getElementById('infoPanel').innerHTML =
    '<div class="font-semibold mb-1">Instructions</div>Fill in each section carefully and completely. Use the <strong>SBI (Situation‚ÄìBehavior‚ÄìImpact)</strong> format to support your examples whenever possible.';

  // reset d·ªØ li·ªáu
  clearCards();
  document.getElementById('mgrAnswers').innerHTML = '';
  document.getElementById('icAnswers').innerHTML  = '';

  // HI·ªÜN l·∫°i c√°c h∆∞·ªõng d·∫´n ƒë√£ b·ªã ·∫©n l√∫c load example
  const mgrP   = document.querySelector('#panelMgr > p');
  const mgrTip = document.querySelector('#panelMgr > .bg-blue-50');
  if (mgrP)   mgrP.classList.remove('hidden');
  if (mgrTip) mgrTip.classList.remove('hidden');

  const icP    = document.querySelector('#panelIC > p');
  const icTip  = document.querySelector('#panelIC > .bg-blue-50'); // tip non-managerial (hi·ªán t·∫°i l√† div)
  if (icP)    icP.classList.remove('hidden');
  if (icTip)  icTip.classList.remove('hidden');

  // tabs tr·∫°ng th√°i m·∫∑c ƒë·ªãnh
  document.getElementById('tabIC').classList.remove('hidden');
  document.getElementById('roleTabs').classList.remove('opacity-50','pointer-events-none');
  setRoleTab('mgr');

  // badge
  document.getElementById('crossNotice').classList.add('hidden');
  document.getElementById('onePrefBadge').classList.add('hidden');
}

/* ===== Example data (ƒë·ªß tr∆∞·ªùng SBI) ===== */
const examples = {
  pd: {
    name:'Tran Minh Anh',
    dept:'Product Development',
    role:'Product Developer',
    pref1:'Team Leader of Product Development',
    pref2:'Senior Team Leader of Product Engineering',
    cross:true,
    relocate:'Yes (MY/CN ok)',
    change:'Yes',
    rs1:'Lead innovation & launch readiness for PD projects.',
    rs2:'Bridge design‚Äìmanufacturing as technical leader.',
    aspShort:'Own full NPI cycle with tighter vendor coordination.',
    aspMid:'Grow into cross-functional technical leadership.',

    // Managerial
    mgrA1:'Empowering & structured; set clear goals, enable creative problem-solving.',
    mgrS:'Team morale dropped during a delayed sample build.',
    mgrB:'Introduced daily 10-min syncs, spotlighted wins, unblocked issues quickly.',
    mgrI:'Team delivered 1 week earlier; engagement scores +18% in pulse check.',

    // Non-managerial
    icA1:'CAD (SolidWorks), DFM/A, rapid prototyping, BOM control, 8D root cause.',
    icS:'Prototype failed drop test due to weak base joint.',
    icB:'Redesigned joint with gusset; coordinated 24-hour 3D-print with vendor.',
    icI:'Passed retest; rework ‚Üì20%; design added to PD guidelines.'
  },
  qa: {
    name:'Nguyen Hoang Long',
    dept:'Quality Assurance (Asia)',
    role:'Quality Assurance CI',
    pref1:'Vendor Champion',
    pref2:'‚Äî',
    cross:false,
    relocate:'Open within VN',
    change:'Within QA only',
    rs1:'Elevate supplier quality performance across regions.',
    rs2:'‚Äî',
    aspShort:'Strengthen audit readiness and vendor coaching.',
    aspMid:'Drive regional quality excellence as Vendor Champion.',

    // Managerial
    mgrA1:'Supportive yet data-driven; set standards, enable autonomy, coach via data.',
    mgrS:'High defect rate at a priority vendor (PPM +30%).',
    mgrB:'Launched defect-blitz with visual boards & peer coaching; weekly Gemba.',
    mgrI:'Defects ‚àí15% in 2 months; vendor sustained SPC at target.'
    // QA kh√¥ng c√≥ non-managerial
  }
};

/* ===== Load example & render ===== */
function loadExample(type){
  toggleMenu();
  const ex = examples[type];

  // Header
  document.getElementById('infoPanel').innerHTML =
    `<div class="font-semibold mb-1">${ex.name} ‚Äì ${ex.role}</div>Example case loaded.`;

  // Fill cards
  setText('bi-name', ex.name);  setText('bi-dept', ex.dept);  setText('bi-role', ex.role);
  setText('pref1', ex.pref1);   setText('pref2', ex.pref2);
  setText('rs1', ex.rs1);       setText('rs2', ex.rs2);
  setText('mob-relocate', ex.relocate); setText('mob-change', ex.change);
  setText('asp-short', ex.aspShort);    setText('asp-mid', ex.aspMid);

  // Badges
  const cross = document.getElementById('crossNotice');
  ex.cross ? cross.classList.remove('hidden') : cross.classList.add('hidden');
  const onePref = document.getElementById('onePrefBadge');
  (!ex.pref2 || ex.pref2 === '‚Äî') ? onePref.classList.remove('hidden') : onePref.classList.add('hidden');

  /* ==== Managerial (2 c√¢u: c√¢u 2 c√≥ SBI s√°t c√¢u h·ªèi) ==== */
  document.getElementById('mgrAnswers').innerHTML = `
    <div class="bg-white border rounded p-3 shadow-[0_0_0_1px_rgba(59,130,246,0.15)] space-y-3">
      <div class="text-[11px] font-semibold uppercase tracking-wide text-blue-700">
        How would you describe your leadership style?
      </div>
      <div>‚Ä¢ ${ex.mgrA1 || '‚Äî'}</div>

      <div class="text-[11px] font-semibold uppercase tracking-wide text-blue-700">
        Share an example of a time you successfully motivated a team.
      </div>
      <div class="mt-1 space-y-0.5 text-gray-800">
        <div><strong>Situation:</strong> ${ex.mgrS || '‚Äî'}</div>
        <div><strong>Behavior:</strong> ${ex.mgrB || '‚Äî'}</div>
        <div><strong>Impact:</strong> ${ex.mgrI || '‚Äî'}</div>
      </div>
    </div>`;

  /* ==== Non-managerial (ch·ªâ PD c√≥) ==== */
  let icHTML = '';
  if (ex.icA1 || ex.icS || ex.icB || ex.icI){
    icHTML = `
      <div class="bg-white border rounded p-3 shadow-[0_0_0_1px_rgba(59,130,246,0.15)] space-y-3">
        <div class="text-[11px] font-semibold uppercase tracking-wide text-blue-700">
          Which technical skills make you a strong candidate for this role?
        </div>
        <div>‚Ä¢ ${ex.icA1 || '‚Äî'}</div>

        <div class="text-[11px] font-semibold uppercase tracking-wide text-blue-700">
          Share an example of how you solved a complex work-related problem.
        </div>
        <div class="mt-1 space-y-0.5 text-gray-800">
          <div><strong>Situation:</strong> ${ex.icS || '‚Äî'}</div>
          <div><strong>Behavior:</strong> ${ex.icB || '‚Äî'}</div>
          <div><strong>Impact:</strong> ${ex.icI || '‚Äî'}</div>
        </div>
      </div>`;
  }
  document.getElementById('icAnswers').innerHTML = icHTML;

  /* ·∫®n h∆∞·ªõng d·∫´n v√¨ ƒë√£ c√≥ example */
  const mgrP  = document.querySelector('#panelMgr > p');
  const mgrTip= document.querySelector('#panelMgr > .bg-blue-50');
  if (mgrP)  mgrP.classList.add('hidden');
  if (mgrTip)mgrTip.classList.add('hidden');
  const icP   = document.querySelector('#panelIC > p');
  const icList= document.querySelector('#panelIC > ul');
  if (icP)   icP.classList.add('hidden');
  if (icList)icList.classList.add('hidden');
  const icTip = document.querySelector('#panelIC > .bg-blue-50');
  if (icTip) icTip.classList.add('hidden');


  /* Hi·ªÉn th·ªã tab: PD c√≥ 2 tab; QA ch·ªâ Managerial */
  if(icHTML){
    document.getElementById('tabIC').classList.remove('hidden');
    document.getElementById('roleTabs').classList.remove('opacity-50','pointer-events-none');
  }else{
    document.getElementById('tabIC').classList.add('hidden');
    document.getElementById('panelIC').classList.add('hidden');
    document.getElementById('roleTabs').classList.add('opacity-50','pointer-events-none');
  }

  /* √âP v·ªÅ tab Managerial & ·∫®N IC khi v·ª´a load (ƒëi·ªÉm b·∫°n h·ªèi) */
  setRoleTab('mgr');                         // lu√¥n m·ªü Managerial
  document.getElementById('panelIC').classList.add('hidden'); // ch·∫Øc ch·∫Øn ·∫©n IC
  document.getElementById('tabMgr').focus();                   // focus n√∫t Managerial
}

/* Reset c√°c th·∫ª khi b·∫•m Show Instructions */
function clearCards(){
  ['bi-name','bi-dept','bi-role','pref1','pref2','rs1','rs2','mob-relocate','mob-change','asp-short','asp-mid']
    .forEach(id => document.getElementById(id).innerText = '‚Äî');
}
</script>
      <div class="mt-4 flex flex-wrap gap-2">
  <!-- Link to MS Form -->
  <a
  	data-link-id="round2_ms_form"
	href="#"
	target="_blank"
	class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">
    Open Application Form
  </a>

  <!-- Link to Talent NextGen Booklet -->
  <a
  	data-link-id="round2_booklet"
	href="#"
	target="_blank"
    class="bg-white border border-blue-400 text-blue-600 px-4 py-2 rounded-lg text-sm hover:bg-blue-50">
    Talent NextGen Program Introduction Booklet
  </a>
</div>
    </div>
  </details>

  <!-- ROUND 3 -->
  <details class="group bg-orange-50 border-l-4 border-ashley-orange rounded-r-lg mb-4">
    <summary class="flex items-center justify-between cursor-pointer select-none px-5 py-3">
      <span class="font-semibold text-ashley-orange text-base flex items-center gap-2">
        ü§ù Round 3 ‚Äì HoD Review & Position Matching
      </span>
      <svg class="h-5 w-5 text-ashley-orange transition-transform duration-200 ease-out group-open:rotate-90">
        <path fill="currentColor"
          d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.12l3.71-2.89a.75.75 0 1 1 1.04 1.08l-4.24 3.31a.75.75 0 0 1-.93 0L5.21 8.31a.75.75 0 0 1 .02-1.1z" />
      </svg>
    </summary>

    <div class="px-5 pb-4 pt-1 text-sm text-gray-800">
      <p class="mb-3">From successor applications, HoDs receive <strong>segmented lists</strong> for review:</p>

		 <!-- Equal-width cards -->
		<div class="grid md:grid-cols-3 gap-4 mb-4">
		  <div class="bg-ashley-orange text-white p-4 rounded-xl text-center font-semibold shadow-sm">
		    Internal Applicants<br>
		    <span class="text-sm opacity-90">(same department)</span>
		  </div>
		  <div class="bg-amber-600 text-white p-4 rounded-xl text-center font-semibold shadow-sm">
		    Incoming Applicants<br>
		    <span class="text-sm opacity-90">(from other departments)</span>
		  </div>
		  <div class="bg-orange-700 text-white p-4 rounded-xl text-center font-semibold shadow-sm">
		    Outgoing Applicants<br>
		    <span class="text-sm opacity-90">(to other departments)</span>
		  </div>
		</div>
		
		<!-- Review process list -->
		<ul class="list-disc pl-5 text-gray-800 space-y-1 mb-4">
		  <li>HoD reviews candidate profiles and <strong>selects successors based on fit with the Success Profile.</strong></li>
		  <li>Considers <strong>department capacity</strong> to provide follow-up development for each position (from Stage 1).</li>
		  <li>AHR consolidates endorsed candidates for <strong>Gap Assessment (Stage 3)</strong>.</li>
		  <li><strong>Non-selected applicants</strong> receive a thank-you message and development encouragement.</li>
		</ul>
		
		<!-- Important notes (moved below, orange title) -->
		<div class="bg-white border border-orange-200 rounded-lg p-3 mt-4">
		  <p class="font-medium text-ashley-orange mb-1">Important notes:</p>
		  <ul class="list-disc pl-5 text-gray-700 space-y-1">
		    <li>Cross-department applications should be handled with <strong>sensitivity</strong> and clear communication.</li>
		    <li>Employees are encouraged to apply <strong>cross-functionally</strong> when roles align with their skills and long-term career goals.</li>
		    <li>HoDs should view cross-applications as <strong>growth potential</strong> ‚Äî not dissatisfaction or disengagement.</li>
		  </ul>
		</div>
      </div>
  </details>

  <!-- stage 2 SUMMARY LINE -->
  <div class="bg-white border-l-4 border-gray-400 rounded-r-lg p-4 text-sm text-gray-800">
    <span class="font-bold text-green-700">Round 1</span> shortlists nominees based on potential, 
    <span class="font-bold text-blue-700">Round 2</span> empowers employees to apply, and 
    <span class="font-bold text-ashley-orange">Round 3</span> confirms the final endorsed list for Stage 3 ‚Äì Gap Assessment.
  </div>
</div>
</div>
        <!-- STEP 3 CONTENT -->
        <div id="step-3" class="step-content hidden">
          <div class="bg-white rounded-xl border p-6 mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">STAGE 3: Gap Assessment</h3>
            <p class="text-gray-600 mb-6">Module song song ¬∑ T·ª± ƒë√°nh gi√° ¬∑ X√°c nh·∫≠n c·ªßa qu·∫£n l√Ω ¬∑ Ph√¢n lo·∫°i s·∫µn s√†ng</p>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-semibold mb-2">System Setup (Mirror Module)</h4>
                <ul class="text-sm text-gray-700 space-y-1">
                  <li>‚Ä¢ Separate from Performance; role‚Äëbased access; mock‚Äëdata UAT.</li>
                  <li>‚Ä¢ Define features & UX with CN System Team.</li>
                  <li>‚Ä¢ Files: System_Module_Feature_List.xlsx; UI_Wireframe_Sample.pdf</li>
                </ul>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-semibold mb-2">Part A ‚Äì Candidate Self‚ÄëAssessment (1‚Äì5)</h4>
                <ul class="text-sm text-gray-700 space-y-1">
                  <li>‚Ä¢ 1‚Äì2: describe gaps; 3: meets + improve; 4‚Äì5: SBI examples.</li>
                  <li>‚Ä¢ Map current experience to job qualifications.</li>
                </ul>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-semibold mb-2">Part B ‚Äì Manager Validation & Readiness</h4>
                <p class="text-sm text-gray-700">Assign: Ready Now (‚â§6m) ¬∑ Ready Soon (‚â§2y) ¬∑ Development Needed (>2y) ¬∑ Not Ready. Comments visible to candidates; readiness visible to AHR & HoD only.</p>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-semibold mb-2">Part C ‚Äì Gap Summary & Dashboard</h4>
                <ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ Template_Gap_Analysis_Sheet.xlsx</li><li>‚Ä¢ Gap_Analysis_Summary_Report_DeptName.xlsx</li><li>‚Ä¢ PowerBI_Gap_Tracking_Layout.pdf</li></ul>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-semibold mb-2">Part D ‚Äì Talent Pool Announcement</h4>
                <p class="text-sm text-gray-700">Ready Now & Ready Soon ‚Üí Talent Pool; Development Needed ‚Üí Talent Watch; Not Ready ‚Üí Thank‚Äëyou + feedback pointers. (Email_Talent_Pool_Confirmation.docx)</p>
              </div>
              <div class="bg-ashley-orange/10 p-4 rounded-lg">
                <h4 class="font-semibold text-ashley-orange mb-2">Interactive Demo (10‚Äô)</h4>
                <p class="text-sm text-gray-700">Self‚Äërate 3 competencies ‚Üí leader adjusts ‚Üí assign readiness ‚Üí update gap sheet.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- STAGE 4 CONTENT -->
        <div id="step-4" class="step-content hidden">
          <div class="bg-white rounded-xl border p-6 mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">STAGE 4: IDP Execution ‚Äì Closing the Gap</h3>
            <p class="text-gray-600 mb-6">Thi·∫øt k·∫ø IDP ¬∑ 70‚Äë20‚Äë10 ¬∑ Theo d√µi h√†ng qu√Ω</p>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Design Flow</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ AHR workshop ‚Üí Successor drafts IDP based on gaps & readiness</li><li>‚Ä¢ Approvals (Leader, HoD) ‚Üí Quarterly updates</li></ul></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">70‚Äë20‚Äë10 Framework</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ 70 Doing ‚Äì projects, acting role, rotation</li><li>‚Ä¢ 20 Others ‚Äì coaching, mentoring, peer groups</li><li>‚Ä¢ 10 Formal ‚Äì courses, certifications</li></ul></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Tracking & Review</h4><p class="text-sm text-gray-700">Quarterly review; leader audit; notify aspiration/strategy shifts. Power BI for portfolio tracking.</p></div>
              <div class="bg-white border rounded-lg p-4"><h4 class="font-semibold mb-3">Files</h4><div class="grid sm:grid-cols-2 gap-3"><button class="bg-ashley-orange text-white px-3 py-2 rounded-lg">üì• IDP_Template_Successor.xlsx</button><button class="bg-ashley-orange text-white px-3 py-2 rounded-lg">üì• IDP_Review_Checklist_Leader.docx</button></div></div>
            </div>
          </div>
        </div>

        <!-- STAGE 5 CONTENT -->
        <div id="step-5" class="step-content hidden">
          <div class="bg-white rounded-xl border p-6 mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">STAGE 5: Talent Review Presentation</h3>
            <p class="text-gray-600 mb-6">B√°o c√°o ti·∫øn ƒë·ªô h√†ng nƒÉm ¬∑ Ph·∫£n h·ªìi h·ªôi ƒë·ªìng</p>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Event Format</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ Successor presents progress & evidence</li><li>‚Ä¢ Panel feedback ‚Üí Revise IDP</li><li>‚Ä¢ Audience: Leader, HoD, AHR, senior leaders (if available)</li></ul></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Benefits for Successors</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ Priority learning access</li><li>‚Ä¢ Cross‚Äëfunctional visibility</li><li>‚Ä¢ Strategic projects</li><li>‚Ä¢ Eligible for Asia Domination (GS)</li></ul></div>
              <div class="bg-white border rounded-lg p-4"><h4 class="font-semibold mb-3">Files</h4><div class="grid sm:grid-cols-2 gap-3"><button class="bg-ashley-orange text-white px-3 py-2 rounded-lg">üì• Talent_Review_Presentation_Template.pptx</button><button class="bg-ashley-orange text-white px-3 py-2 rounded-lg">üì• Talent_Review_Panel_Feedback_Form.docx</button></div></div>
              <div class="bg-ashley-orange/10 p-4 rounded-lg"><h4 class="font-semibold text-ashley-orange mb-2">Evidence Sprint (5‚Äô)</h4><p class="text-sm text-gray-700">Draft 3 evidence items to showcase progress this year.</p></div>
            </div>
          </div>
        </div>

        <!-- STAGE 6 CONTENT -->
        <div id="step-6" class="step-content hidden">
          <div class="bg-white rounded-xl border p-6 mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">STAGE 6: Continuous Review & Yearly Refresh</h3>
            <p class="text-gray-600 mb-6">Theo d√µi KPI ¬∑ L·∫Øng nghe ph·∫£n h·ªìi ¬∑ L√†m m·ªõi Talent Pool</p>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Semi‚ÄëAnnual KPIs</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ % critical roles with ‚â•1 successor</li><li>‚Ä¢ % on‚Äëtime IDP updates</li><li>‚Ä¢ % IDP actions completed</li><li>‚Ä¢ Participation in development activities</li></ul></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Annual KPIs</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ Internal fill rate for critical roles</li><li>‚Ä¢ % successors advancing readiness</li><li>‚Ä¢ Talent Pool retention (12‚Äì18m)</li></ul></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Feedback & Improvement</h4><ul class="text-sm text-gray-700 space-y-1"><li>‚Ä¢ Successor & HoD satisfaction; training effectiveness</li><li>‚Ä¢ Adjust tools & process; refresh pool after year‚Äëend review</li></ul></div>
              <div class="bg-white border rounded-lg p-4"><h4 class="font-semibold mb-3">Survey</h4><button class="bg-ashley-orange text-white px-3 py-2 rounded-lg">üìù Talent_Program_Feedback_Survey_Form</button></div>
            </div>
          </div>
        </div>

        <!-- Prev/Next -->
        <div class="flex justify-between">
          <button onclick="previousStep()" id="prev-btn" class="bg-gray-300 text-gray-500 px-6 py-2 rounded-xl cursor-not-allowed" disabled>‚Üê Previous Stage</button>
          <button onclick="nextStep()" id="next-btn" class="bg-ashley-orange text-white px-6 py-2 rounded-xl hover:bg-ashley-orange-dark">Next Stage ‚Üí</button>
        </div>
      </div>
    </section>

    <!-- TOOLS TAB -->
    <section id="tools-tab" class="tab-content hidden">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">Tools & Templates</h2>
        <p class="text-gray-600 mb-6">C√¥ng c·ª• & M·∫´u bi·ªÉu</p>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div class="bg-white border rounded-xl p-6 hover:shadow-md transition-shadow">
            <div class="w-12 h-12 bg-ashley-orange rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üìä</span></div>
            <h3 class="font-semibold text-gray-900 mb-2">Critical Position Evaluation</h3>
            <p class="text-sm text-gray-500 mb-4">Scoring matrix for role prioritization</p>
<a href="https://masterashley-my.sharepoint.com/:x:/g/personal/anguyen_ashleyfurniture_com/ESRPdp4SMZlBkVt48EwOKMMBBzPAPFD4wZPGAxpuxeIygA?e=U2DyCS" 
   target="_blank" 
   class="w-full block text-center bg-ashley-orange text-white py-2 px-4 rounded-xl hover:bg-ashley-orange-dark">
  üì• Download Excel
</a>
</div>

<div class="bg-white border rounded-xl p-6 hover:shadow-md transition-shadow">
  <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üë§</span>

</div>
            <h3 class="font-semibold text-gray-900 mb-2">Success Profile Template</h3>
            <p class="text-sm text-gray-500 mb-4">Competency framework builder</p>
            <button class="w-full bg-ashley-orange text-white py-2 px-4 rounded-xl hover:bg-ashley-orange-dark">üì• Download Excel</button>
          </div>
          <div class="bg-white border rounded-xl p-6 hover:shadow-md transition-shadow">
            <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üìã</span></div>
            <h3 class="font-semibold text-gray-900 mb-2">Gap Assessment Tool</h3>
            <p class="text-sm text-gray-500 mb-4">Readiness evaluation matrix</p>
            <button class="w-full bg-ashley-orange text-white py-2 px-4 rounded-xl hover:bg-ashley-orange-dark">üì• Download Excel</button>
          </div>
          <div class="bg-white border rounded-xl p-6 hover:shadow-md transition-shadow">
            <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üß≠</span></div>
            <h3 class="font-semibold text-gray-900 mb-2">IDP Template & Review</h3>
            <p class="text-sm text-gray-500 mb-4">70‚Äë20‚Äë10 + quarterly checkpoints</p>
            <div class="grid grid-cols-2 gap-2"><button class="bg-ashley-orange text-white py-2 px-3 rounded-lg">üì• IDP.xlsx</button><button class="bg-ashley-orange text-white py-2 px-3 rounded-lg">üì• Review.docx</button></div>
          </div>
          <div class="bg-white border rounded-xl p-6 hover:shadow-md transition-shadow">
            <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">üìë</span></div>
            <h3 class="font-semibold text-gray-900 mb-2">Talent Review Pack</h3>
            <p class="text-sm text-gray-500 mb-4">Slides + panel form</p>
            <div class="grid grid-cols-2 gap-2"><button class="bg-ashley-orange text-white py-2 px-3 rounded-lg">üì• Template.pptx</button><button class="bg-ashley-orange text-white py-2 px-3 rounded-lg">üì• Panel.docx</button></div>
          </div>
          <div class="bg-white border rounded-xl p-6 hover:shadow-md transition-shadow">
            <div class="w-12 h-12 bg-rose-500 rounded-lg flex items-center justify-center mb-4"><span class="text-white text-xl">‚úâÔ∏è</span></div>
            <h3 class="font-semibold text-gray-900 mb-2">Comms & Survey</h3>
            <p class="text-sm text-gray-500 mb-4">Email + feedback survey</p>
            <div class="grid grid-cols-2 gap-2"><button class="bg-ashley-orange text-white py-2 px-3 rounded-lg">üì• Talent_Pool_Confirmation.docx</button><button class="bg-ashley-orange text-white py-2 px-3 rounded-lg">üìù Feedback Survey</button></div>
          </div>
        </div>

            </section>

    <!-- METRICS & GOVERNANCE TAB -->
    <section id="metrics-tab" class="tab-content hidden">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">Metrics & Governance</h2>
        <p class="text-gray-600 mb-6">Ch·ªâ s·ªë & Qu·∫£n tr·ªã</p>
        <div class="bg-white rounded-xl border p-6 mb-6">
          <h3 class="text-xl font-semibold mb-4">Key Performance Indicators</h3>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-4">
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-medium text-gray-900 mb-2">Succession Readiness Rate</h4><p class="text-sm text-gray-600">% of critical roles with ready successors</p></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-medium text-gray-900 mb-2">Internal Fill Rate</h4><p class="text-sm text-gray-600">% of leadership roles filled internally</p></div>
            </div>
            <div class="space-y-4">
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-medium text-gray-900 mb-2">Time to Fill</h4><p class="text-sm text-gray-600">Average days to fill critical positions</p></div>
              <div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-medium text-gray-900 mb-2">Development Progress</h4><p class="text-sm text-gray-600">% completion of successor IDPs</p></div>
            </div>
          </div>
        </div>
        <div class="bg-white rounded-xl border p-6">
          <h3 class="text-xl font-semibold mb-4">RACI (Lite)</h3>
          <div class="overflow-auto">
            <table class="min-w-full text-sm text-center border">
              <thead class="bg-gray-50"><tr><th class="p-2 border">Stage</th><th class="p-2 border">AHR</th><th class="p-2 border">HoD</th><th class="p-2 border">Leader</th><th class="p-2 border">Successor</th><th class="p-2 border">StratEx</th><th class="p-2 border">SysDev</th></tr></thead>
              <tbody>
                <tr><td class="p-2 border">1</td><td class="p-2 border">A</td><td class="p-2 border">R</td><td class="p-2 border">C</td><td class="p-2 border">I</td><td class="p-2 border">C</td><td class="p-2 border">I</td></tr>
                <tr><td class="p-2 border">2</td><td class="p-2 border">A</td><td class="p-2 border">R</td><td class="p-2 border">C</td><td class="p-2 border">I</td><td class="p-2 border">I</td><td class="p-2 border">I</td></tr>
                <tr><td class="p-2 border">3</td><td class="p-2 border">A</td><td class="p-2 border">R</td><td class="p-2 border">R</td><td class="p-2 border">C</td><td class="p-2 border">C</td><td class="p-2 border">R</td></tr>
                <tr><td class="p-2 border">4</td><td class="p-2 border">A</td><td class="p-2 border">C</td><td class="p-2 border">R</td><td class="p-2 border">R</td><td class="p-2 border">C</td><td class="p-2 border">I</td></tr>
                <tr><td class="p-2 border">5</td><td class="p-2 border">A</td><td class="p-2 border">C</td><td class="p-2 border">C</td><td class="p-2 border">R</td><td class="p-2 border">I</td><td class="p-2 border">I</td></tr>
                <tr><td class="p-2 border">6</td><td class="p-2 border">A</td><td class="p-2 border">C</td><td class="p-2 border">C</td><td class="p-2 border">I</td><td class="p-2 border">R</td><td class="p-2 border">I</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

<!-- FAQ & Q&A TAB -->
<section id="faq-tab" class="tab-content hidden">
  <div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-900 mb-2">FAQ & Live Q&A</h2>
    <p class="text-gray-600 mb-6">C√¢u h·ªèi th∆∞·ªùng g·∫∑p & k√™nh h·ªèi ƒë√°p tr·ª±c ti·∫øp c√πng AHR</p>

    <!-- ====== FAQ ACCORDION ====== -->
    <div class="space-y-4 mb-10">
      <div class="bg-white rounded-xl border">
        <button onclick="toggleAccordion('faq-1', event)" class="w-full text-left p-6 flex justify-between items-center hover:bg-gray-50">
          <h4 class="font-semibold text-gray-900">How often should we update succession plans?</h4>
          <span class="accordion-icon text-ashley-orange">‚ñº</span>
        </button>
        <div id="faq-1" class="accordion-content hidden p-6 pt-0 border-t">
          <p class="text-gray-600">Review quarterly and update annually, or after significant org changes.</p>
        </div>
      </div>

      <div class="bg-white rounded-xl border">
        <button onclick="toggleAccordion('faq-2', event)" class="w-full text-left p-6 flex justify-between items-center hover:bg-gray-50">
          <h4 class="font-semibold text-gray-900">What if we don't have internal successors ready?</h4>
          <span class="accordion-icon text-ashley-orange">‚ñº</span>
        </button>
        <div id="faq-2" class="accordion-content hidden p-6 pt-0 border-t">
          <p class="text-gray-600">Accelerate development, use interim leadership, and consider external pipeline while you build internal capability.</p>
        </div>
      </div>

      <div class="bg-white rounded-xl border">
        <button onclick="toggleAccordion('faq-3', event)" class="w-full text-left p-6 flex justify-between items-center hover:bg-gray-50">
          <h4 class="font-semibold text-gray-900">Alice c√≥ ƒë·∫πp g√°i kh√¥ng?</h4>
          <span class="accordion-icon text-ashley-orange">‚ñº</span>
        </button>
        <div id="faq-3" class="accordion-content hidden p-6 pt-0 border-t">
          <p class="text-gray-600">C√≥. Alice super ƒë·∫πp g√°i lu√¥n.</p>
        </div>
      </div>

      <div class="bg-white rounded-xl border">
        <button onclick="toggleAccordion('faq-4', event)" class="w-full text-left p-6 flex justify-between items-center hover:bg-gray-50">
          <h4 class="font-semibold text-gray-900">Is succession equal to promotion?</h4>
          <span class="accordion-icon text-ashley-orange">‚ñº</span>
        </button>
        <div id="faq-4" class="accordion-content hidden p-6 pt-0 border-t">
          <p class="text-gray-600">No. Readiness informs development plans; it is not a promise of immediate title change.</p>
        </div>
      </div>

      <div class="bg-white rounded-xl border">
        <button onclick="toggleAccordion('faq-5', event)" class="w-full text-left p-6 flex justify-between items-center hover:bg-gray-50">
          <h4 class="font-semibold text-gray-900">Ch·ªã Hannie c√≥ b·ªã kh√πm hem?</h4>
          <span class="accordion-icon text-ashley-orange">‚ñº</span>
        </button>
        <div id="faq-5" class="accordion-content hidden p-6 pt-0 border-t">
          <p class="text-gray-600">ƒê√∫m z.</p>
        </div>
      </div>
    </div>

    <!-- ====== LIVE Q&A (SLIDO EMBED) ====== -->
    <div class="bg-white rounded-2xl border-2 border-orange-100 shadow-soft p-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-2xl font-semibold text-ashley-orange flex items-center gap-2">
          üí¨ Live Q&A Discussion
        </h3>
        <span class="text-sm text-gray-500">Powered by Slido</span>
      </div>
      <p class="text-gray-600 mb-4">
        Post your questions below ‚Äî the AHR team will respond publicly during and after workshops.
      </p>

      <!-- Slido embed -->
      <iframe 
        src="https://app.sli.do/event/oR1ty2ZQGQvK1eAbvHwe1y"
        height="100%"
        width="100%"
        frameborder="0"
        style="min-height: 560px; border-radius: 0.75rem;"
        allow="clipboard-write"
        title="Slido">
      </iframe>
    </div>
  </div>
</section>
  </main>

 <!-- QUESTION MODAL -->
<div id="questionModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 z-[60]">
  <div class="bg-white w-full max-w-lg rounded-2xl p-6 shadow-xl">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">I have a question!</h3>
      <button onclick="closeQuestionModal()" class="text-gray-500 hover:text-gray-700">‚úñ</button>
    </div>
    <p class="text-sm text-gray-600 mb-3">Type your question below and click send.</p>

    <!-- Form g·ª≠i email (ti·∫øng Vi·ªát kh√¥ng l·ªói) -->
<form onsubmit="sendEmail(event)">
  <textarea id="questionInput" 
            class="w-full border rounded-xl px-3 py-2 mb-3 h-32" 
            placeholder="Submit your question here to send email to our team..."></textarea>
  <div class="flex justify-end gap-2">
    <button type="button" onclick="closeQuestionModal()" 
            class="bg-white border px-3 py-2 rounded-xl">Cancel</button>
    <button type="submit" 
            class="bg-ashley-orange text-white px-3 py-2 rounded-xl">Send</button>
  </div>
</form>

<script>
  function sendEmail(e) {
    e.preventDefault();
    const question = document.getElementById("questionInput").value;
    const subject = encodeURIComponent("C√¢u h·ªèi t·ª´ Website");
    const body = encodeURIComponent(question);
    const to = "anguyen@ashleyfurniture.com,hphamhong@ashleyfurniture.com";
    window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
  }
</script>
  </div>
</div>
<script>
  function showQuestionModal() {
    document.getElementById('questionModal').classList.remove('hidden');
    document.getElementById('questionModal').classList.add('flex');
  }
  function closeQuestionModal() {
    document.getElementById('questionModal').classList.add('hidden');
    document.getElementById('questionModal').classList.remove('flex');
  }
</script>

  <script>
    // ========== State ==========
let currentStep = 1;
let facilitatorMode = false;

    // ========== Tabs (Top-level) ==========
    function showTab(tabName, e){
      // hide all tabs
      document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));
      // show selected
      const target = document.getElementById(`${tabName}-tab`);
      if(target){ target.classList.remove('hidden'); }
      // update nav highlight by data attribute
      document.querySelectorAll('.nav-tab').forEach(btn=>{
        if(btn.dataset.tab === tabName){
          btn.classList.add('border-b-2','border-ashley-orange');
        } else {
          btn.classList.remove('border-b-2','border-ashley-orange');
        }
      });
      // if called from CTAs (no event), still highlight via data attribute
      if(e && e.preventDefault) e.preventDefault();
    }


    // ========== Accordions ==========
    function toggleAccordion(id, e){
      const content=document.getElementById(id);
      const icon=e.currentTarget.querySelector('.accordion-icon');
      if(content.classList.contains('hidden')){ content.classList.remove('hidden'); content.classList.add('fade-in'); icon.textContent='‚ñ≤'; }
      else { content.classList.add('hidden'); icon.textContent='‚ñº'; }
    }
	
    // ========== Framework Stepper ==========
    function showStep(stepNum, e){
      currentStep=stepNum;
      document.querySelectorAll('.step-content').forEach(c=>c.classList.add('hidden'));
      const cur = document.getElementById(`step-${stepNum}`); if(cur) cur.classList.remove('hidden');
      document.querySelectorAll('.step-btn').forEach(b=>{ b.classList.remove('bg-ashley-orange','text-white'); b.classList.add('bg-gray-200','text-gray-700'); });
      if(e){ e.target.classList.remove('bg-gray-200','text-gray-700'); e.target.classList.add('bg-ashley-orange','text-white'); }
      const indicators=document.querySelectorAll('.step-indicator'); const lines=document.querySelectorAll('.step-line');
      indicators.forEach((el,i)=>{ if(i<stepNum){ el.classList.remove('bg-gray-300','text-gray-600'); el.classList.add('bg-ashley-orange','text-white'); } else { el.classList.remove('bg-ashley-orange','text-white'); el.classList.add('bg-gray-300','text-gray-600'); } });
      lines.forEach((ln,i)=>{ if(i<stepNum-1){ ln.classList.remove('bg-gray-300'); ln.classList.add('bg-ashley-orange'); } else { ln.classList.remove('bg-ashley-orange'); ln.classList.add('bg-gray-300'); } });
	  document.getElementById('stepLabel').textContent = `Stage ${stepNum} of 6`;
      const prevBtn=document.getElementById('prev-btn'); const nextBtn=document.getElementById('next-btn');
      if(stepNum===1){ prevBtn.disabled=true; prevBtn.classList.add('cursor-not-allowed','bg-gray-300','text-gray-500'); }
      else { prevBtn.disabled=false; prevBtn.classList.remove('cursor-not-allowed','bg-gray-300','text-gray-500'); prevBtn.classList.add('bg-ashley-orange','text-white'); }
      nextBtn.textContent=(stepNum===6)?'Complete':'Next ‚Üí';
    }
	function nextStep(){ if(currentStep<6) showStep(currentStep+1);window.scrollTo({ top: 0, behavior: 'smooth' });
}
	function previousStep(){ if(currentStep>1) showStep(currentStep-1); window.scrollTo({ top: 0, behavior: 'smooth' });
}

    // ========== STAGE 1 inner tabs (IDs prefixed to avoid collisions) ==========
    function showStepTab(tabName, e){
      const scope = document.getElementById('step-1');
      scope.querySelectorAll('.step-tab-content').forEach(t=>t.classList.add('hidden'));
      const id = `s1-${tabName}-tab`;
      const tgt = document.getElementById(id);
      if(tgt){ tgt.classList.remove('hidden'); }
      scope.querySelectorAll('.step-tab-btn').forEach(b=>{ b.classList.remove('border-ashley-orange','text-ashley-orange'); b.classList.add('border-transparent','text-gray-500'); });
      if(e){ e.target.classList.remove('border-transparent','text-gray-500'); e.target.classList.add('border-ashley-orange','text-ashley-orange'); }
    }

    // ========== QR Board ==========
    function question(){ const m=document.getElementById('qrModal'); m.classList.remove('hidden'); m.classList.add('flex'); }
    function closeQRBoard(){ const m=document.getElementById('qrModal'); m.classList.add('hidden'); m.classList.remove('flex'); }
    function copyQRLink(){ const i=document.getElementById('qrInput'); if(!i.value) return alert('Paste a link first'); navigator.clipboard.writeText(i.value).then(()=>alert('Link copied')); }

 // ========== Init ==========
  document.addEventListener('DOMContentLoaded', ()=>{ showTab('home'); });
</script>

<!-- =================== SEARCH MODAL (HTML) =================== -->
<div id="searchModal" 
     class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 z-[100]">
  <div class="bg-white w-full max-w-lg rounded-2xl p-6 shadow-xl">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold text-gray-800">üîé Search Playbook</h3>
      <button onclick="closeSearchModal()" class="text-gray-500 hover:text-gray-700">‚úñ</button>
    </div>
    <input id="searchInput"
           type="text"
           placeholder="Enter keyword (e.g. Stage 3, IDP, Criteria...)"
           class="w-full border rounded-xl px-3 py-2 mb-4 focus:ring-2 focus:ring-orange-300 focus:outline-none" />
    <div id="searchResults" class="max-h-64 overflow-y-auto text-sm space-y-2 text-gray-700"></div>
  </div>
</div>

<!-- =================== SEARCH MODAL (JS) =================== -->
<script>
  /* Open / Close */
  function openSearchModal() {
    const m = document.getElementById('searchModal');
    m.classList.remove('hidden'); m.classList.add('flex');
    const ip = document.getElementById('searchInput');
    ip.value = '';
    document.getElementById('searchResults').innerHTML = '';
    ip.focus();
  }
  function closeSearchModal() {
    const m = document.getElementById('searchModal');
    m.classList.add('hidden'); m.classList.remove('flex');
    clearHighlights();
  }
  /* ====== Utils ====== */
  function escReg(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }

  function buildSnippet(text, query, pad=80){
    const q = query.trim();
    if(!q) return '';
    const re = new RegExp(escReg(q), 'i');
    const m = text.match(re);
    if(!m) return '';
    const i = m.index;
    const start = Math.max(0, i - pad);
    const end   = Math.min(text.length, i + q.length + pad);
    let snippet = text.slice(start, end);
    // th√™m d·∫•u ‚Ä¶ n·∫øu c·∫Øt ƒë·∫ßu/cu·ªëi
    if(start>0) snippet = '‚Ä¶' + snippet;
    if(end<text.length) snippet = snippet + '‚Ä¶';
    // highlight trong snippet
    snippet = snippet.replace(new RegExp(escReg(q), 'ig'), (s)=>`<mark>${s}</mark>`);
    return snippet;
  }

  function clearHighlights(){
    document.querySelectorAll('mark.search-highlight').forEach(mark=>{
      const text = document.createTextNode(mark.textContent);
      mark.parentNode.replaceChild(text, mark);
    });
  }

  function highlightIn(container, query){
    if(!container || !query) return;
    const selector = 'h1,h2,h3,h4,h5,h6,p,li,span,td,th';
    const re = new RegExp(escReg(query), 'ig');
    let firstHit = null;

    container.querySelectorAll(selector).forEach(el=>{
      // b·ªè qua c√°c v√πng c√≥ qu√° nhi·ªÅu t∆∞∆°ng t√°c/HTML
      if(el.closest('button, a, input, textarea, select')) return;
      const html = el.innerHTML;
      if(!html) return;
      if(!re.test(el.textContent)) return;
      // thay th·∫ø tr√™n innerHTML (ƒë∆°n gi·∫£n, ƒë·ªß an to√†n cho text/heading)
      const replaced = html.replace(re, (s)=>{
        if(!firstHit) firstHit = true; // ƒë√°nh d·∫•u ƒë√£ c√≥ hit ƒë·∫ßu ti√™n
        return `<mark class="search-highlight">${s}</mark>`;
      });
      el.innerHTML = replaced;
    });

    // cu·ªôn ƒë·∫øn highlight ƒë·∫ßu ti√™n
    const first = container.querySelector('mark.search-highlight');
    if(first && first.scrollIntoView){
      first.scrollIntoView({ behavior:'smooth', block:'center' });
    } else {
      window.scrollTo({ top:0, behavior:'smooth' });
    }
  }

  /* ====== Push result item ====== */
  function addResult(list, label, tab, step, anchorSelector, snippet){
    list.push({ label, tab, step, anchorSelector, snippet });
  }

  /* ====== Build results with snippets (c√≥ c·∫£ inner tabs c·ªßa Step 1) ====== */
  function buildSearchResults(query){
    const q = (query||'').trim().toLowerCase();
    const results = [];
    if(!q) return results;

    // HOME
    const home = document.getElementById('home-tab');
    if(home && home.textContent.toLowerCase().includes(q)){
      addResult(
        results,
        'Home',
        'home',
        null,
        '#home-tab h1',
        buildSnippet(home.textContent, query)
      );
    }

    // FRAMEWORK: Step 1-6
    for(let i=1;i<=6;i++){
      const stepEl = document.getElementById(`step-${i}`);
      if(stepEl && stepEl.textContent.toLowerCase().includes(q)){
        const h = stepEl.querySelector('h2,h3,h4');
        addResult(
          results,
          `Framework ‚Üí Stage ${i}`,
          'framework',
          i,
          h ? null : null, // anchor s·∫Ω t·ª± t√¨m h2/h3/h4 trong click
          buildSnippet(stepEl.textContent, query)
        );
      }
    }

    // Step 1 inner tabs (Overview, Criteria, Scoring, Profile, Tools)
    const innerTabs = [
      { key:'overview', id:'s1-overview-tab',  label:'Framework ‚Üí Stage 1 ‚Üí Overview' },
      { key:'criteria', id:'s1-criteria-tab',  label:'Framework ‚Üí Stage 1 ‚Üí Criteria' },
      { key:'scoring',  id:'s1-scoring-tab',   label:'Framework ‚Üí Stage 1 ‚Üí Scoring' },
      { key:'profile',  id:'s1-profile-tab',   label:'Framework ‚Üí Stage 1 ‚Üí Success Profile' },
      { key:'tools',    id:'s1-tools-tab',     label:'Framework ‚Üí Stage 1 ‚Üí Tools' },
    ];
    innerTabs.forEach(t=>{
      const el = document.getElementById(t.id);
      if(el && el.textContent.toLowerCase().includes(q)){
        addResult(
          results,
          t.label,
          'framework',
          1,
          `#${t.id}`,
          buildSnippet(el.textContent, query)
        );
      }
    });

    // TOOLS
    const tools = document.getElementById('tools-tab');
    if(tools && tools.textContent.toLowerCase().includes(q)){
      addResult(
        results,
        'Tools & Templates',
        'tools',
        null,
        '#tools-tab h2',
        buildSnippet(tools.textContent, query)
      );
    }

    // METRICS
    const metrics = document.getElementById('metrics-tab');
    if(metrics && metrics.textContent.toLowerCase().includes(q)){
      addResult(
        results,
        'Metrics & Governance',
        'metrics',
        null,
        '#metrics-tab h2',
        buildSnippet(metrics.textContent, query)
      );
    }

    // FAQ
    const faq = document.getElementById('faq-tab');
    if(faq && faq.textContent.toLowerCase().includes(q)){
      addResult(
        results,
        'FAQ',
        'faq',
        null,
        '#faq-tab h2',
        buildSnippet(faq.textContent, query)
      );
    }

    return results;
  }

  /* ====== Render list + click to navigate & highlight ====== */
  function renderSearchResults(results, query){
    const box = document.getElementById('searchResults');
    box.innerHTML = '';

    if(!results.length){
      box.innerHTML = '<p class="text-gray-500 italic">No matches found.</p>';
      return;
    }

    results.forEach((r, idx)=>{
      const item = document.createElement('button');
      item.type = 'button';
      item.className = 'w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 border';
      const snippetHtml = r.snippet ? `<div class="text-xs text-gray-600 search-snippet mt-1">${r.snippet}</div>` : '';
      item.innerHTML = `
        <div class="font-medium">${r.label}</div>
        <div class="text-[11px] text-gray-500">Go to ${r.tab}${r.step ? ' ¬∑ Stage ' + r.step : ''}</div>
        ${snippetHtml}
      `;

      item.addEventListener('click', ()=>{
        // 1) m·ªü ƒë√∫ng tab
        showTab(r.tab);

        // 2) n·∫øu l√† Framework v√† c√≥ step ‚Üí m·ªü step
        if(r.tab==='framework' && r.step){
          showStep(r.step);
        }

        // 3) x√°c ƒë·ªãnh container ƒë·ªÉ highlight
        let container = null;
        if(r.tab==='framework' && r.step){
          container = document.getElementById(`step-${r.step}`);
          // n·∫øu l√† inner tab
          if(r.anchorSelector && r.anchorSelector.startsWith('#s1-')){
            // m·ªü inner tab t∆∞∆°ng ·ª©ng
            const key = r.anchorSelector.replace(/^#s1-/, '').replace(/-tab$/,'');
            if(typeof showStepTab === 'function'){
              showStepTab(key);
            }
          }
        } else {
          container = document.getElementById(`${r.tab}-tab`);
        }

        // 4) highlight + scroll
        setTimeout(()=>{
          clearHighlights();
          if(container){
            highlightIn(container, document.getElementById('searchInput').value);
          } else {
            window.scrollTo({ top:0, behavior:'smooth' });
          }
        }, 0);

        // 5) ƒë√≥ng modal
        closeSearchModal();
      });

      box.appendChild(item);

      if(idx < results.length-1){
        const hr = document.createElement('div');
        hr.className = 'border-b my-1';
        box.appendChild(hr);
      }
    });
  }

  /* ====== Live search ====== */
  document.getElementById('searchInput').addEventListener('input', function(e){
    const q = e.target.value || '';
    const results = buildSearchResults(q);
    renderSearchResults(results, q);
  });
</script>
<script>
/* ========== Search highlight: ch·ªâ ch·∫°y khi click k·∫øt qu·∫£ ========== */
(function(){
  let highlightTimer = null;

  function escapeRegex(s){
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  // Th√°o to√†n b·ªô <mark class="search-highlight"> trong scope (ho·∫∑c to√†n trang)
  function clearHighlights(scope){
    const root = scope || document;
    const marks = root.querySelectorAll('mark.search-highlight');
    marks.forEach(m => {
      const text = document.createTextNode(m.textContent);
      m.parentNode.replaceChild(text, m);
    });
    // G·ªôp text node li·ªÅn k·ªÅ cho s·∫°ch DOM
    (root.normalize && root.normalize());
  }

  // B·ªçc t·ª´ kho√° b·∫±ng <mark> trong container ch·ªâ ƒë·ªãnh
  function highlightIn(container, term){
    if (!container || !term) return 0;
    const words = term.trim().split(/\s+/).filter(Boolean);
    if (!words.length) return 0;

    const rx = new RegExp('(' + words.map(escapeRegex).join('|') + ')', 'gi');

    // Duy·ªát text node v√† b·ªçc match
    const walker = document.createTreeWalker(
      container,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode(node){
          if (!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
          const p = node.parentNode;
          if (!p) return NodeFilter.FILTER_REJECT;
          const tag = p.nodeName.toLowerCase();
          if (tag === 'script' || tag === 'style' || tag === 'noscript' || tag === 'mark') {
            return NodeFilter.FILTER_REJECT;
          }
          return rx.test(node.nodeValue) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        }
      }
    );

    let count = 0;
    const toProcess = [];
    while (walker.nextNode()) toProcess.push(walker.currentNode);

    toProcess.forEach(textNode => {
      const frag = document.createDocumentFragment();
      const parts = textNode.nodeValue.split(rx); // [text, match, text, match...]
      for (let i = 0; i < parts.length; i++){
        const seg = parts[i];
        if (!seg) continue;
        if (rx.test(seg) && i % 2 === 1){
          const mark = document.createElement('mark');
          mark.className = 'search-highlight';
          mark.textContent = seg;
          frag.appendChild(mark);
          count++;
        } else {
          frag.appendChild(document.createTextNode(seg));
        }
      }
      textNode.parentNode.replaceChild(frag, textNode);
    });

    return count;
  }

  // Cu·ªôn t·ªõi highlight ƒë·∫ßu ti√™n trong container
  function scrollFirstHighlight(container){
    const first = container.querySelector('mark.search-highlight');
    if (first){
      first.scrollIntoView({behavior:'smooth', block:'center'});
    }
  }

  // Public API: g·ªçi h√†m n√†y khi click 1 k·∫øt qu·∫£ search
  // opts = { tab?: 'home'|'framework'|'tools'|'metrics'|'faq', step?: 1..6, container: 'CSS selector', term: 't·ª´ kho√°' }
  window.goToAndHighlight = function(opts){
    if (!opts || !opts.container || !opts.term) return;

    // H·ªßy timer & g·ª° highlight c≈© tr∆∞·ªõc khi ƒëi·ªÅu h∆∞·ªõng
    if (highlightTimer){ clearTimeout(highlightTimer); highlightTimer = null; }
    clearHighlights(document);

    // ƒêi·ªÅu h∆∞·ªõng: tab -> step (n·∫øu c√≥)
    if (opts.tab) window.showTab && window.showTab(opts.tab);
    if (opts.step) window.showStep && window.showStep(Number(opts.step));

    // Ch·ªù DOM render sau showTab/showStep r·ªìi m·ªõi highlight
    requestAnimationFrame(() => {
      const container = document.querySelector(opts.container);
      if (!container) return;

      // Ch·ªâ highlight trong ƒë√∫ng container c·ªßa k·∫øt qu·∫£
      const total = highlightIn(container, opts.term);
      if (total > 0){
        scrollFirstHighlight(container);
        // T·ª± g·ª° sau 5s (th√°o h·∫≥n <mark>)
        highlightTimer = setTimeout(() => {
          clearHighlights(container);
          highlightTimer = null;
        }, 5000);
      }
    });
  };

  // G·ª° highlight khi ƒë·ªïi TAB (ƒë·ªÉ kh√¥ng ‚Äús√°ng‚Äù l·∫°i khi quay l·∫°i)
  if (window.showTab){
    const _showTab = window.showTab;
    window.showTab = function(tabName, e){
      if (highlightTimer){ clearTimeout(highlightTimer); highlightTimer = null; }
      clearHighlights(document);
      return _showTab.call(this, tabName, e);
    };
  }

  // G·ª° highlight khi ƒë·ªïi STEP trong Framework
  if (window.showStep){
    const _showStep = window.showStep;
    window.showStep = function(stepNum, e){
      if (highlightTimer){ clearTimeout(highlightTimer); highlightTimer = null; }
      // Ch·ªâ c·∫ßn s·∫°ch trong khu v·ª±c framework ƒë·ªÉ nhanh
      const fw = document.getElementById('framework-tab');
      clearHighlights(fw || document);
      return _showStep.call(this, stepNum, e);
    };
  }
})();
</script>
<script>
  // ƒê∆∞·ªùng d·∫´n CSV (ch·ªâ ch·ª©a link)
  const CSV_URL = "./assets/links.csv";

  // Parser CSV g·ªçn (kh√¥ng c·∫ßn th∆∞ vi·ªán)
  function parseCSV(text) {
    const lines = text.replace(/^\uFEFF/, "").trim().split(/\r?\n/);
    const headers = lines[0].split(",").map(s => s.trim());
    return lines.slice(1).filter(Boolean).map(line => {
      // t√°ch ƒë∆°n gi·∫£n; n·∫øu c√≥ nhi·ªÅu d·∫•u ph·∫©y trong d·∫•u ngo·∫∑c k√©p, h√£y d√πng parser n√¢ng cao
      const cols = [];
      let cur = "", q = false;
      for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          if (q && line[i+1] === '"') { cur += '"'; i++; } else { q = !q; }
        } else if (ch === ',' && !q) { cols.push(cur); cur = ""; }
        else cur += ch;
      }
      cols.push(cur);
      const obj = {};
      headers.forEach((h, i) => obj[h] = (cols[i] ?? "").replace(/^"|"$/g,"").trim());
      return obj;
    });
  }

  async function wireLinksFromCSV() {
    try {
      const res = await fetch(`${CSV_URL}?v=${Date.now()}`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`CSV fetch failed ${res.status}`);
      const text = await res.text();
      const rows = parseCSV(text);

      // T·∫°o map theo id trong CSV
      const mapById = Object.fromEntries(rows.map(r => [r.id, r]));

      // T√¨m t·∫•t c·∫£ ph·∫ßn t·ª≠ c√≥ data-link-id
      document.querySelectorAll("[data-link-id]").forEach(el => {
        const key = el.getAttribute("data-link-id");
        const item = mapById[key];
        if (!item || !item.url) return;
        el.setAttribute("href", item.url);
        // Kh√¥ng ƒë·ª•ng target/style/text ‚Äî b·∫°n ƒë√£ ki·ªÉm so√°t trong HTML
      });

    } catch (err) {
      console.error("Wire CSV links error:", err);
      // (tu·ª≥ ch·ªçn) hi·ªÉn th·ªã th√¥ng b√°o l·ªói ·ªü ƒë√¢u ƒë√≥ n·∫øu b·∫°n mu·ªën
    }
  }

  window.linksReady = wireLinksFromCSV();
</script>
</body>
</html>